# 更新日志 (CHANGELOG)

## [2.2.0] - 2025-07-10

### 🎉 新增功能
- **导出报告目录功能**
  - 为所有导出格式添加政策目录，提升文档可读性
  - Word文档：在开头添加目录标题和序号列表，包含政策时间
  - Excel文件：创建独立的"目录"工作表，包含序号、标题、发布日期、层级
  - 文本文件：在开头添加目录部分，使用分隔线区分，包含政策时间
  - Markdown文件：添加二级标题目录，支持锚点链接跳转，包含政策时间

### ✅ 修复问题
- **修复爬虫状态监控对话框语法错误**
  - 修复`StatusUpdateThread`类中访问不存在属性的错误
  - 优化爬虫实例获取逻辑，确保监控功能正常工作
  - 修复导出模块Excel功能中的类型检查问题

### 🔧 技术改进
- **导出功能增强**
  - 统一的数据解析逻辑，支持多种数据格式
  - 针对不同格式特点优化目录显示
  - 完善的错误处理和默认值设置

- **监控功能优化**
  - 改进爬虫状态获取机制
  - 优化多爬虫实例监控支持
  - 增强错误处理和异常恢复

### 📝 代码变更
- `src/space_planning/utils/export.py`
  - 为`export_to_word()`函数添加目录生成，包含政策时间
  - 为`export_to_excel()`方法添加目录工作表，增加发布日期列
  - 为`export_to_txt()`方法添加目录部分，包含政策时间
  - 为`export_to_markdown()`方法添加目录链接，包含政策时间
  - 修复Excel导出中的类型检查问题

- `src/space_planning/gui/crawler_status_dialog.py`
  - 修复`StatusUpdateThread`类中的属性访问错误
  - 优化爬虫实例获取逻辑
  - 改进错误处理机制

### 🎯 用户体验改进
- **快速导航**：用户可以通过目录快速定位到感兴趣的政策
- **内容预览**：目录提供政策概览，便于了解报告结构
- **专业格式**：符合正式文档的标准格式要求
- **多格式支持**：无论选择哪种导出格式，都能获得目录功能

### 🧪 测试验证
- 验证所有导出格式的目录功能正常工作
- 确认Word、Excel、文本、Markdown格式目录显示正确
- 测试爬虫监控功能修复效果
- 验证语法错误修复完成

### 📋 已知问题
- 无

### 🔄 向后兼容性
- 完全向后兼容v2.1.4版本
- 保持现有导出功能不变
- 数据库结构无变化

---

## [2.1.4] - 2025-07-09

### 🎉 新增功能
- **广东省政策分类层级结构支持**
  - 父级分类：地方性法规、地方政府规章、规范性文件
  - 子级分类：省级、设区的市、经济特区等细分类型
  - 政策类型字段显示为"父级分类 > 子级分类"格式

### ✅ 修复问题
- 无

### 🔧 技术改进
- **重构分类数据结构**
  - 支持层级关系，更符合网站实际分类结构
  - 新增`_get_full_category_name`方法生成完整分类名称
  - 保持扁平化分类接口的向后兼容性

- **优化分类显示**
  - 更清晰的分类层次结构显示
  - 便于用户理解政策类型归属
  - 符合网站实际分类结构

### 📝 代码变更
- `src/space_planning/spider/guangdong.py`
  - 重构`_get_all_categories`方法，支持层级结构
  - 新增`_get_flat_categories`方法，保持向后兼容
  - 新增`_get_full_category_name`方法，生成层级分类名称
  - 修改`_parse_policy_item_optimized`方法，使用层级分类

### 🎯 用户体验改进
- 政策类型显示更加清晰和层次化
- 用户可以快速识别政策的分类归属
- 分类结构更符合法律体系的实际层次

### 🧪 测试验证
- 验证层级分类结构正确生成
- 确认政策类型字段正确显示层级格式
- 测试向后兼容性，确保现有功能正常

### 📋 已知问题
- 无

### 🔄 向后兼容性
- 完全向后兼容v2.1.3版本
- 保持扁平化分类接口
- 数据库结构无变化

---

## [2.1.0] - 2025-07-08

### 🎉 新增功能
- 无

### ✅ 修复问题
- **修复广东省爬虫分类显示问题**
  - 问题描述：广东省政策的"政策类型"列显示为智能分类结果，而不是实际的分类名称
  - 解决方案：修复数据传递机制，确保分类信息正确传递到GUI界面
  - 影响范围：广东省政策爬虫和GUI显示

### 🔧 技术改进
- **优化政策类型字段显示逻辑**
  - 改进GUI中政策类型列的显示条件判断
  - 确保广东省政策优先显示分类名称
  - 优化数据流中的分类信息处理

- **完善数据传递机制**
  - 在GUI回调函数中添加category字段解析
  - 在爬虫POLICY_DATA消息中包含分类信息
  - 修复数据流中的分类信息丢失问题

### 📝 代码变更
- `src/space_planning/gui/main_window.py`
  - 修改progress_callback函数，添加category字段解析
  - 更新show_about函数，显示新版本信息
  - 改进政策类型显示逻辑

- `src/space_planning/spider/guangdong.py`
  - 修改POLICY_DATA消息格式，包含category字段
  - 确保分类信息正确传递

### 🎯 用户体验改进
- 广东省政策现在正确显示分类名称（如"地方规范性文件"、"经济特区法规"等）
- 表格政策类型列显示更加准确和有用
- 用户可以通过分类名称快速识别政策类型

### 📦 新增功能
- **Windows安装程序打包功能**
  - 新增PyInstaller打包脚本，支持生成单个可执行文件
  - 支持生成便携版打包，包含启动脚本、卸载程序和完整文档
  - 支持生成标准Windows安装程序（Inno Setup），包含完整安装向导
  - 提供多种打包方式选择，满足不同分发需求
  - 完整的安装向导、卸载功能和系统集成

### 🧪 测试验证
- 验证广东省爬虫分类信息正确传递
- 确认GUI界面正确显示分类名称
- 测试翻页功能和数据解析正常
- 验证打包功能正常工作

### 📋 已知问题
- 无

### 🔄 向后兼容性
- 完全向后兼容v2.0.0版本
- 数据库结构无变化
- 配置文件格式无变化

---

## [2.0.0] - 2025-07-07

### 🎉 新增功能
- 广东省爬虫翻页功能完全修复
- 实时爬虫状态监控
- 增强的错误处理和重试机制

### ✅ 修复问题
- 修复广东省爬虫翻页逻辑问题
- 优化HTML解析准确性
- 完善防反爬虫机制

### 🔧 技术改进
- 实现两步翻页请求机制
- 优化政策项目识别算法
- 增强异常处理能力

---

## [1.0.0] - 2025-07-05

### 🎉 初始版本
- 基础爬虫功能
- 数据库管理
- 合规性分析
- 数据导出功能 

## [2.1.4] - 2025-07-09
- 导出格式支持Markdown，满足学术与协作需求。
- 导出支持单选、多选、全选，灵活导出所需政策。
- 导出统计信息，导出后显示导出条数和结果。
- 时间选择逻辑BUG修复，切换预设模式时不会自动跳转到自定义。
- 安装包优化，自动生成安装版和ZIP包，附带启动/卸载脚本和详细说明。
- 依赖精简建议，推荐只打包实际用到的包，减少体积和依赖冲突。
- requirements.txt与打包脚本同步更新。
- 数据库持久化机制说明，便于用户理解数据安全性。
- README结构优化，新用户更易上手。
- 版本号、日期、依赖等信息同步更新。 