//内容检索 2016-5-6 by likai
//获取Url 里面指定参数的值
function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return decodeURI(r[2]); return null;
}

var RecordSearch = {

    init: function () {

        RecordSearch.dispose();

        var IsAdvSearch = $("#IsAdvSearch").val();
        if (IsAdvSearch != null && IsAdvSearch != "") {
            $("#recordsort").show();
        }

        $('.areajSelect').subSearchJselect();
        $('.subjSelect').subSearchJselect();

        //筛选项和聚类显示结果中检索
        var isShowResultSearch = $("#isShowResultSearch").val();
        if (isShowResultSearch != null && isShowResultSearch != "") {
            $('.results-btn').show();
            $("#btnSearch").html("新检索");

        }


        //批量下载
        $('.list-filtrater .oparetion .down-all').recordDown();
        //列表内容工具点击
        $('.tools-box').dropDowm();
        //全选勾选框
        $('#choose-all').checkBoxForAll();

        $('#checkReportItems').checkBoxForAll();
        //批量打印
        $('.print-all').fulltextPrint();

        //批量下载
        $('#batchDownload').click(function () {

            //var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            //if (isLogin != "true") { //没登录 关闭当前下载框打开登录框
            //    $("#loginBtn").click();
            //    return false;
            //};

            var gids = new Array();
            var gidJson = new Array();
            var idx = 0;
            $("input[name='recordList']:checkbox:checked").each(function () {
                var gid = $(this).val();
                //var idx = $(this).parent().parent().index();
                var obj = { "idx": idx, "gid": gid };
                gidJson.push(obj);
                gids.push(gid);
                idx++;
            });
            if (gids.length == 0) {
                alert("请勾选要下载的项");
                return false;
            }
            gids = gids.join(",");
            gidJson = JSON.stringify(gidJson);
            var lib = $("input[name='Library']").val();
            var libs = new Array();
            if (lib == "gdd") {
                $("input[name='recordList']:checkbox:checked").each(function () {
                    libs.push($(this).attr("lib"));
                });
            } else {
                libs.push(lib);
            }
            var orderIndex = $("input[name='OrderByIndex']").val();
            var fieldsChecked = new Array();
            $("input[name='catalog']:checkbox:checked").each(function () {

                fieldsChecked.push($(this).val());
            });
            var curMenu = $("input[name='curMenu']").val();
            var keepfields = $("input[name='keepfields']").is(':checked');
            if (curMenu == "english") {
                keepfields = $("input[name='fields']").is(':checked');
            }

            var keepFblxInFulltext = $("input[name='keepfblx']").is(':checked');
            var keeprelated = $("input[name='keeprelated']").is(':checked');

            var viewType = $("input[name='viewType']").val();

            var condition = "";
            $('.condition a').each(function () {
                var text = $(this).context.innerText + "；";
                condition = condition + text;
            });



            $("input[name='batchDownload']:radio:checked").each(function () {
                if ($(this).val() != null && $(this).val() != undefined) {

                    var url = "";
                    var data = {};
                    var form;
                    var catalogType = $(this).val();
                    switch (catalogType) {
                        case 'catalogTxt':
                        case 'catalogWord':
                        case 'catalogHtml':
                        case 'catalogExcel':
                            url = "/full/DownloadCatalog";
                            data = { "typeName": catalogType, "library": lib, "gids": gidJson, "curLib": libs, "orderIndex": orderIndex, "isDetect": "true" };//isDetect:查询标识
                            form = $("<form></form>");
                            // form.attr('action', url + "?typeName=" + catalogType + ",library=" + lib + ",gids=" + gids + ",curLib=" + libs + ",orderIndex=" + orderIndex);
                            form.attr('action', url);
                            form.attr('method', 'post');
                            form.attr('target', '_blank');

                            form.append("<input name='typeName' value='" + catalogType + "'/>");
                            form.append("<input name='condition' value='" + condition + "'/>");
                            form.append("<input name='library' value='" + lib + "'/>");
                            form.append("<input name='gids' value='" + gidJson + "'/>");
                            form.append("<input name='curLib' value='" + libs + "'>");
                            form.append("<input name='flag' value='" + viewType + "'>");
                            form.append("<input name='fields' value='" + fieldsChecked + "'>");
                            form.append("<input name='orderIndex' value='" + orderIndex + "'/>");
                            break;
                        case 'fullTxt':
                        case 'fullWord':
                        case 'fullHyper':
                        case 'fullPure':
                        case 'fullPdf':
                        case 'fullOfd':
                        case 'english':
                        case 'chinese':
                        case 'block':
                        case 'list':
                        case 'EnglishTxt':

                            url = "/full/DownloadFullText";
                            data = { "typeName": catalogType, "library": lib, "gids": gids, "curLib": libs, "isDetect": "true" };//isDetect:查询标识

                            form = $("<form></form>");
                            form.attr('action', url);
                            form.attr('method', 'post');
                            form.attr('target', '_blank');

                            form.append("<input name='typeName' value='" + catalogType + "'/>");
                            form.append("<input name='keepFields' value='" + keepfields + "'/>");
                            form.append("<input name='keepFblxInFulltext' value='" + keepFblxInFulltext + "'/>");
                            form.append("<input name='keepRelatedFile' value='" + keeprelated + "'/>");
                            form.append("<input name='library' value='" + lib + "'/>");
                            form.append("<input name='flag' value='" + viewType + "'>");
                            form.append("<input name='gids' value='" + gids + "'/>");
                            form.append("<input name='curLib' value='" + libs + "'>");


                            break;
                    }
                    //if (!checkIsLimited(url, data)) {
                        form.appendTo("body");
                        form.css('display', 'none');
                        form.submit();
                        form.remove();
                    //}
                }
            });
            return false;
        });


        function checkIsLimited(url, data) {
            //先查询下载数量是否被限制， 
            var isLimited = true;
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                async: false,
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                success: function (result) {
                    isLimited = false;

                },
                error: function (result) {

                    isLimited = true;
                    //被限制，弹窗提醒
                    var html = result.responseText;
                    var layerIndex = layer.open({
                        type: 1,
                        title: false, //不显示标题  
                        area: ['475px', 'auto'],
                        offset: 'auto',
                        btn: false,
                        move: false, //不可移动
                        content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                        shade: [0.05, '#000'], //遮罩透明度
                        shadeClose: true, //点击遮罩关闭弹框
                        success: function () {
                            $('#BtnCloseLayer').click(function () {
                                layer.close(layerIndex);
                            });
                        }
                    });
                }
            });
            return isLimited;
        }












        //批量收藏
        $('#batchAddFav').click(function () {

            //var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            //if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

            //    $("#loginBtn").click();
            //    return false;
            //}


            var lib = $("input[name='Library']").val();

            var addList = [];
            $("input[name='recordList']:checkbox:checked").each(function () {
                if ($(this).val() != null && $(this).val() != undefined) {
                    var title = $(this).parent().find("h4").find('a').eq(0).text();
                    var item = {
                        Library: lib,
                        Gid: $(this).val(),
                        Title: title
                    };
                    addList.push(item);
                }
            });
            addList = JSON.stringify(addList);

            if (addList == "[]") {
                alert("请勾选要收藏的项");
                return false;
            }


            var addurl = "/UserRelated/BatchAddFavorite";

            $.ajax({
                type: "POST",
                url: addurl,
                data: { param: addList },
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                //dataType: "JSON",
                success: function (data) {
                    var jsonObj = eval('(' + data + ')');

                    var suc = jsonObj.success;
                    var exi = jsonObj.exist;
                    var fai = jsonObj.failed;
                    var result = "";
                    //if (suc != "0") {
                    //    result += "收藏成功" + suc + "条  ";
                    //}
                    //if (exi != "0") {
                    //    result += "已经收藏过" + exi + "条 ";
                    //}
                    //if (fai != "0") {
                    //    result += "收藏失败" + fai + "条";
                    //}
                    if (suc != "0" || exi != "0") {
                        result += "收藏成功！";
                    }
                    if (fai != "0") {
                        result += "收藏失败！";
                    }
                    layer.msg(result, {
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）                      
                    });
                },
                error: function (data) {
                }
            });
            return false;
        });

        //批量打印
        $('#batchPrint').click(function () {

            //var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            //if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

            //    $("#loginBtn").click();
            //    return false;
            //}
            var downloadType = $("input:radio[name='batchprint']:checked").val();

            var gids = new Array();
            var libs = new Array();
            $("input[name='recordList']:checkbox:checked").each(function () {
                gids.push($(this).val());
            });
            if (gids.length == 0) {
                alert("请勾选要打印的项");
                return false;
            }
            gids = gids.join(",");
            var lib = $("input[name='Library']").val();
            var orderIndex = $("input[name='OrderByIndex']").val();

            var url = "/Full/BatchPrint";
            //$.ajax({
            //    type: "GET",
            //    url: url,
            //    data: { downloadType: downloadType, library: lib, gids: gids },
            //    contentType: "application/x-www-form-urlencoded; charset=utf-8",
            //    //dataType: "JSON",
            //    success: function (data) {

            //    },
            //    error: function (data) {
            //    }
            //});

            var form = $("<form></form>");
            form.attr('action', url);
            form.attr('method', 'post');
            form.attr('target', '_blank');

            form.append("<input name='downloadType' value='" + downloadType + "'/>");
            form.append("<input name='library' value='" + lib + "'/>");
            form.append("<input name='gids' value='" + gids + "'/>");
            form.append("<input name='libs' value='" + libs + "'>");
            form.append("<input name='orderIndex' value='" + orderIndex + "'/>");

            form.appendTo("body");
            form.css('display', 'none');
            form.submit();
            form.remove();
            return false;
        });

        //批量转发
        $('.batchTransmit').click(function () {

            //var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            //if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

            //    $("#loginBtn").click();
            //    return false;
            //}

            var gids = new Array();
            $("input[name='recordList']:checkbox:checked").each(function () {
                gids.push($(this).val());
            });
            if (gids.length == 0) {
                alert("请勾选要转发的项");
                return false;
            }
            gids = gids.join(",");
            var lib = $("input[name='Library']").val();
            var orderIndex = $("input[name='OrderByIndex']").val();
            var queryFilter = $('.condition a').text();

            var url = "/Full/BatchTransmitPage";

            var form = $("<form></form>");
            form.attr('action', url);
            form.attr('method', 'post');
            form.attr('target', '_blank');

            form.append("<input name='library' value='" + lib + "'/>");
            form.append("<input name='gids' value='" + gids + "'/>");
            form.append("<input name='orderIndex' value='" + orderIndex + "'/>");
            form.append("<input name='queryFilter' value='" + queryFilter + "'/>");

            form.appendTo("body");
            form.css('display', 'none');
            form.submit();
            form.remove();
            return false;
        });

        //列表单篇文章下载弹窗
        $('.recordDownload').click(function () {

            //var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            //if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

            //    $("#loginBtn").click();
            //    return false;
            //}

            var library = $("input[name='Library']").val();
            if (library == "gdd") {
                library = $(this).parent().parent().parent().find("input[type='checkbox']").attr("lib");
            }
            var gid = $(this).parent().find("input").val();

            var width = '500px';
            var height = '240px';
            var title = "全文下载";

            var libname = library.substring(0, 2);
            if (libname == "en") {
                width = "530px";
                height = '280px';
                title = "Download";
            }

            $.post("/Full/RecordDownloadFullText", { library: library }, function (html) {

                layer.open({
                    content: html, //内容
                    area: [width, height],
                    title: title, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示           
                    shade: [0.01, '#000'],
                    success: function () {
                        $("#downLoadGid").val(gid);
                        $("#gddLib").val(library);
                    }
                });
            });
        });

        //列表单篇全文收藏
        $('.recordAddFavorite').click(function () {

            //var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            //if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

            //    $("#loginBtn").click();
            //    return false;
            //}

            var lib = $("input[name='Library']").val();
            var gid = $(this).parent().find("input").val();
            var title = $(this).parent().parent().parent().find("h4").find('a').eq(0).text();

            var sddurl = " /usercenter/addfavorite?gid=" + gid + "&library=" + lib + "&title=" + encodeURIComponent(title);

            $.ajax({
                type: "GET",
                url: sddurl,
                dataType: "script",
                contentType: "application/x-www-form-urlencoded; charset=utf-8"
            });

            return false;
        });

        //列表单篇文章打印
        $('.recordPrint').click(function () {

            //var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            //if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

            //    $("#loginBtn").click();
            //    return false;
            //}


            var downloadType = "FullText";
            var lib = $("input[name='Library']").val();
            if (lib == "gdd") {
                lib = $(this).parent().parent().parent().find("input[type='checkbox']").attr("lib");
            }

            var gid = $(this).parent().find("input").val();
            var libs = new Array();

            var form = $("<form></form>");
            form.attr('action', "/Full/BatchPrint");
            form.attr('method', 'post');
            form.attr('target', '_blank');

            form.append("<input name='downloadType' value='" + downloadType + "'/>");
            form.append("<input name='library' value='" + lib + "'/>");
            form.append("<input name='gids' value='" + gid + "'/>");
            form.append("<input name='libs' value='" + libs + "'>");

            var inputs = $("#right_form").find("input");
            for (var i = 0; i < inputs.length; i++) {
                form.append($(inputs[i]).clone());
            }


            form.appendTo("body");
            form.css('display', 'none');
            form.submit();
            form.remove();
            return false;
        });


        //列表单篇文章转发
        $(".recordTransfer").click(function () {
            //var isUserLogin = $("#IsUserLogin").val();
            ////用户未登录
            //if (isUserLogin != "true") {
            //    $("#loginBtn").click();
            //    return false;
            //};

            var lib = $("input[name='Library']").val();
            var gid = $(this).parent().find("input").val();
            var title = $(this).parent().parent().parent().find("h4").find('a').eq(0).text();

            return window.open('/Full/TransmitPage?library=' + lib + "&gid=" + gid + "&title=" + encodeURIComponent(title));
        });


        //列表微信分享
        $(".recordShare").click(function () {


            var lib = $("input[name='Library']").val();
            var gid = $(this).parent().find("input").val();

            var codeUrl = "http://" + window.location.host + "/" + lib + "/" + gid + ".html";

            layer.open({
                title: false,
                btn: false,
                shadeClose: true,
                shade: 0.1,
                area: ['105px', '233px'],
                content: '<style>.layui-layer-dialog{min-width:195px!important;}.share-code{width: 155px;}.share-code.code{width:150px;}.share-code p{font-size: 12px;text-align: center;line-height: 18px;}</style><div class="share-code"><div class="code" id="fulltextWeiXinCode"></div><p>用微信扫描二维码<br/>分享至好友或朋友圈</p></div>'
            });


            if (window.browser.name == 'ie' && window.browser.version < 9) {
                $('#fulltextWeiXinCode').qrcode({
                    render: "table", //table方式
                    width: 150,
                    height: 150,
                    text: codeUrl
                });
            } else {
                $('#fulltextWeiXinCode').qrcode({
                    width: 150,
                    height: 150,
                    text: codeUrl
                });
            }
            return;

        });

        //检索列表案例报告(单篇)
        $(".addcasereport").click(function () {

            //var isUserLogin = $("#IsUserLogin").val();
            ////用户未登录
            //if (isUserLogin != "true") {
            //    $("#loginBuyBtn").click();
            //    return false;
            //} else {
            //    var authorityType = $("#authorityType").val();
            //    if (authorityType != "ValidUser") {
            //        $("#loginAuthorityBtn").click();
            //        return false;
            //    }
            //}

            $U.showProgress();

            var signal = $(this);
            var gid = signal.parent().find("input").val();

            //去数据库取购物车文章
            var existGids = "";
            $.post("/Full/GetShoppingCart", {}, function (data) {
                if (data != "" && data != undefined) {
                    existGids = data;


                    var isExist = $.inArray(gid, existGids.split(','));
                    //-1说明不存在
                    if (isExist == -1) {

                        existGids = existGids + "," + gid;

                        $.post("/Full/AddShoppingCart", { gids: existGids }, function (returnData) {
                            if (returnData != "0") {
                                //文章数量
                                $('.number').html(returnData);
                                $('.number').show();
                                $("#shoppingCartGid").val(existGids);
                                signal.find("i").attr("class", "c-icon c-search-report-off");
                            }
                        });

                        //文章数量
                        //var existCount = existGids.split(',').length;
                        //$('.number').html(existCount);
                        //alert(existCount);

                    } else {
                        signal.find("i").attr("class", "c-icon c-search-report-off");
                        return false;
                    }

                } else {

                    $.post("/Full/AddShoppingCart", { gids: gid }, function (returnData) {
                        if (returnData != "0") {
                            //文章数量
                            $('.number').html(returnData);
                            $('.number').show();
                            $("#shoppingCartGid").val(gid);
                            signal.find("i").attr("class", "c-icon c-search-report-off");
                        }
                    });

                }
            });
            $U.hideProgress();

            //动画效果 数量添加
            $(".number").animate({ 'font-size': '30px', opacity: '0.3' });
            $(".number").animate({ 'font-size': '12px', opacity: '1' });


        });

        //批量案例报告
        $("#batchCaseReport").click(function () {

            //var isUserLogin = $("#IsUserLogin").val();
            ////用户未登录
            //if (isUserLogin != "true") {
            //    $("#loginBtn").click();
            //    return false;
            //};
            //是否选中
            var isChecked = $("input[name='recordList']:checkbox").is(":checked");
            if (isChecked) {

                //去数据库取购物车文章
                var existGids = "";
                $.post("/Full/GetShoppingCart", {}, function (data) {
                    if (data != null) {
                        existGids = data;

                        var newGids = "";
                        $("input[name='recordList']:checkbox:checked").each(function () {

                            var gid = $(this).val();
                            if (existGids != null && existGids != "") {
                                var isExist = $.inArray(gid, existGids.split(','));
                                //-1说明不存在
                                if (isExist == -1) {
                                    newGids = existGids + "," + gid;
                                    existGids = newGids;
                                }
                            } else {
                                newGids = gid;
                                existGids = gid;
                                $("#shoppingCartGid").val(existGids);
                            }
                        });

                        if (newGids != null && newGids != "") {
                            $U.showProgress();
                            $.post("/Full/AddShoppingCart", { gids: newGids }, function (returnData) {
                                if (returnData != "0") {
                                    //文章数量
                                    $('.number').html(returnData);
                                    $('.number').show();
                                    $("#shoppingCartGid").val(newGids);

                                    var gids = newGids.split(',');
                                    $.each(gids, function (index, value) {
                                        $(".grid-right").find("input[value='" + value + "']").prev().find("i").attr("class", "c-icon c-search-report-off");
                                    });

                                    $U.hideProgress();
                                }
                            });
                        }
                    }
                });
                //动画效果 数量添加
                $(".number").animate({ 'font-size': '30px', opacity: '0.3' });
                $(".number").animate({ 'font-size': '12px', opacity: '1' });

            } else {
                alert("请勾选要加入检索报告的项");
                return false;
            }
            return false;


        });

        //购物车添加案例报告
        $(".casereport").click(function () {


            //var isUserLogin = $("#IsUserLogin").val();
            ////用户未登录
            //if (isUserLogin != "true") {
            //    $("#loginBuyBtn").click();
            //    return false;
            //} else {
            //    var authorityType = $("#authorityType").val();
            //    if (authorityType != "ValidUser") {
            //        $("#loginAuthorityBtn").click();
            //        return false;
            //    }
            //}

            $U.showProgress();

            var title = "案例检索报告";
            //var gids = $("#shoppingCartGid").val();

            //if (gids != null && gids != "") {
            $.post("/Full/CaseReportShoppingCart", {}, function (html) {
                $U.hideProgress();
                layer.open({
                    content: html, //内容
                    area: ['830px', '580px'],
                    title: title, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示           
                    shade: [0.01, '#000'],
                    success: function () {

                        //购物车案例
                        var shoppingGids = $("#shoppingGids").val();

                        if (shoppingGids == null || shoppingGids == "") {
                            //购物车窗口数量                  
                            $("#articleCount").html(0);
                            //滚动栏购物车数量
                            $('.number').html(0);
                            $("#shoppingCartGid").val("");

                            $('.number').hide();

                        } else {
                            var num = shoppingGids.split(',').length;
                            //购物车窗口数量     
                            $("#articleCount").html(num);
                            //滚动栏购物车数量
                            $('.number').html(num);
                            $("#shoppingCartGid").val(shoppingGids);

                            $('.number').show();
                        }

                        //选项卡
                        $('#selectReport').click(function () {
                            $('.current-list').show();

                            $('#selectReportDiv').show();
                            $('#newReportDiv').hide();

                            var count = $('.current-list').length + $('.shopping-list').length;
                            $("#articleCount").html(count);
                        });

                        $('#newReport').click(function () {
                            $('.current-list').hide();

                            $('#selectReportDiv').hide();
                            $('#newReportDiv').show();

                            var count = $('.shopping-list').length;
                            $("#articleCount").html(count);

                        });


                        $("#report").change(function () {
                            var gidParam = new Array();

                            $("#shoppingList").find("input[name='shoppingGid']").each(function () {
                                gidParam.push($(this).val());
                            });

                            $("input[name='caseReportId']").val($(this).val());
                            $("input[name='newcasegids']").val(gidParam);

                            $("#report_form").submit();

                        });


                        //添加报告
                        $('#NewshoppingCart,#OldshoppingCart').click(function () {

                            var arraygids = new Array();
                            var casegids = "";
                            var reportId = "";
                            var reportTitle = "";
                            //报告类型
                            var reportType = $("input[name='reportType']:radio:checked").val();
                            if (reportType == "report") {
                                $("#shoppingList").find("input[name='shoppingGid']").each(function () {
                                    arraygids.push($(this).val());
                                });

                                reportTitle = $("#reportTitle").val();
                                if (reportType != "reportArticle") {
                                    if (reportTitle == "" || reportTitle == null) {
                                        alert("报告名称不能为空");
                                        return false;
                                    };
                                }
                            } else {
                                var options = $("#report option:selected"); //获取选中的项
                                reportId = options.val();
                                if (reportId == "clear") {
                                    alert("请选择检索报告");
                                    return false;
                                }

                                $("#shoppingList").find("input[name='shoppingGid']").each(function () {
                                    arraygids.push($(this).val());
                                });
                                $("#shoppingList").find("input[name='caseReportGid']").each(function () {
                                    arraygids.push($(this).val());
                                });

                            }
                            if (arraygids.length == 0) {
                                alert("请选择要添加的案例");
                                return false;
                            }

                            casegids = arraygids.join(",");

                            var form = $("<form></form>");
                            form.attr('action', "/UserRelated/GenerateReport");
                            form.attr('method', 'post');
                            form.attr('target', '_blank');

                            form.append("<input name='reportType' value='" + reportType + "'/>");
                            form.append("<input name='reportTitle' value='" + reportTitle + "'/>");
                            form.append("<input name='reportId' value='" + reportId + "'/>");
                            form.append("<input name='casegids' value='" + casegids + "'/>");

                            form.appendTo("body");
                            form.css('display', 'none');
                            form.submit();
                            form.remove();

                            layer.closeAll();

                            //var gidArray= new Array();
                            //$("#shoppingList").find("input[name='shoppingGid']").each(function () {
                            //    gidArray.push($(this).val());
                            //});
                            //if (gidArray.length > 0) {

                            //    gidArray = gidArray.join(",");

                            //    $.post("/Full/DeleteShoppingCart", { gids: gidArray }, function (data) {
                            //        if (data != "0") {

                            //            $(".number").html(0);
                            //            $("#articleCount").html(0);
                            //            $("#shoppingCartGid").val("");
                            //            $("#shoppingList").find("li").remove();
                            //            $(".grid-right").find("div[class='search-report-wrap']").find("i").attr("class", "c-icon c-search-report-on");
                            //        }
                            //    });
                            //}
                            //layer.closeAll();

                            //$.post("/UserRelated/GenerateReport", {                                    
                            //    reportType: reportType,
                            //    reportTitle: reportTitle,
                            //    reportId: reportId,
                            //    casegids: casegids
                            //}, function(data) {
                            //    if (data == "true") {
                            //        $('.form').hide();
                            //        $('.succeed').show();
                            //    } else if (data == "false") {
                            //        alert("案例报告中已有此篇文章！");
                            //    } else {
                            //        alert("案例报告最多添加100篇文章！");
                            //    }

                            //});


                        });
                    }
                });
            });
            //} else {
            //    $U.hideProgress();
            //    alert("请先选择案例报告！");
            //}
        });


        //重命名案例报告
        $(".rename").click(function () {

            var reportId = $(this).parent().parent().find("input").val();


            $U.showProgress();

            $.post("UserRelated/ReportEditPage", {}, function (html) {
                $U.hideProgress();
                layer.open({
                    content: html, //内容
                    area: ['300px', '250px'],
                    title: false,
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示           
                    shade: [0.01, '#000'],
                    success: function () {


                        $("#confirm").click(function () {

                            var newName = $("#newName").val();

                            if (newName != "" && newName != null) {
                                $("input[name='title']").val(newName);
                                $("input[name='caseReportId']").val(reportId);

                                var form = $("#right_form");
                                form.attr("action", "/usercenter/RenameCaseReport");
                                layer.closeAll();
                                form.submit();
                            } else {
                                return false;
                            }

                        });
                    }
                });
            });
        });

        //删除案例报告
        $(".deleteReport").click(function () {

            var reportId = $(this).parent().parent().find("input").val();
            $("input[name='caseReportId']").val(reportId);

            var form = $("#right_form");
            form.attr("action", "/usercenter/DeleteCaseReport");

            form.submit();

        });

        //删除案例报告文章
        $(".deleteReportArticle").click(function () {
            var articleId = $(this).parent().parent().find("input[name='listArticleId']").val();
            $("input[name='articleId']").val(articleId);

            var form = $("#right_form");
            form.attr("action", "/usercenter/DeleteCaseReportArticle");

            form.submit();
        });


        //批量删除案例报告文章
        $(".delete-all").click(function () {

            var articleId = new Array();
            $("input[name='recordList']:checkbox:checked").each(function () {
                articleId.push($(this).parent().parent().find("input[name='listArticleId']").val());
            });
            if (articleId.length == 0) {
                alert("请勾选要删除的项");
                return false;
            }

            var count = articleId.length;
            var pageCount = parseInt($("input[name='Pager.PageSize']").val());

            if (count >= pageCount) {
                var newPageIndex = 0;
                var pageIndex = parseInt($("input[name='Pager.PageIndex']").val());

                if (pageIndex > 0) {
                    newPageIndex = pageIndex - 1;
                    $("input[name='Pager.PageIndex']").val(newPageIndex);
                }

            }


            articleId = articleId.join(",");

            //var articleId = $(this).parent().parent().find("input[name='reportList']").val();
            $("input[name='articleId']").val(articleId);

            var form = $("#right_form");
            form.attr("action", "/usercenter/DeleteCaseReportArticle");

            form.submit();
        });

        //个人中心开始生成案例报告
        $(".transReport").click(function () {

            var casereportGids = new Array();
            $("input[name='recordList']:checkbox:checked").each(function () {
                casereportGids.push($(this).val());
            });
            if (casereportGids.length == 0) {
                alert("请勾选要生成报告的项");
                return false;
            }
            casereportGids = casereportGids.join(",");

            $("input[name='casereportGids']").val(casereportGids);

            $('#oneStep').hide();
            $('#twoStep').show();

        });

        //生成案例报告(上一步)
        $("#twoLastStep").click(function () {
            $('#oneStep').show();
            $('#twoStep').hide();

        });

        //生成案例报告(上上一步)
        $("#threeLastStep").click(function () {
            $('#threeStep').hide();
            $('#twoStep').show();
            $('.grid-left').show();


        });

        //生成案例报告(上上上一步)
        $("#fourLastStep").click(function () {
            $('#fourStep').hide();
            $('#threeStep').show();
        });

        //生成案例报告
        $("#generateReport").click(function () {

            $('#oneStep').hide();
            $('#twoStep').hide();
            $('.grid-left').hide();
            $('#threeStep').show();

            //报告对象
            var reportObjective = $("input[name='ReportObj']:radio:checked").val();
            $("input[name='caseReportObj']").val(reportObjective);

            //报告项目
            var reportItem = new Array();
            $("input[name='ReportItem']:checkbox:checked").each(function () {
                reportItem.push($(this).val());
            });
            reportItem = reportItem.join(",");
            $("input[name='caseReportItem']").val(reportItem);


            var casereportGids = $("input[name='casereportGids']").val();

            $U.showProgress();
            $.post("/Full/GenerateReport", {
                casereportGids: casereportGids,
                reportObjective: reportObjective,
                reportItem: reportItem
            }, function (data) {
                editor.html(data);
                $U.hideProgress();
            });
        });

        //保存案例报告
        $("#caseReportSave").click(function () {

            var content = editor.html();

            if (content == null || content == " ") {
                alert("报告内容不能为空！");
                return false;
            }

            var caseReportId = $("input[name='caseReportId']").val();

            var reportObjective = $("input[name='caseReportObj']").val();
            var reportItem = $("input[name='caseReportItem']").val();

            $.post("/Full/SaveCaseReport", { caseReportId: caseReportId, content: encodeURIComponent(content), reportObj: reportObjective, reportItem: reportItem }, function (data) {
                if (data == "true") {
                    //alert("保存成功");

                    $.post("/usercenter/CaseReportContent", { caseReportId: caseReportId }, function (result) {
                        $('#threeStep').hide();
                        $('#fourStep').show();
                        $('#showCaseReport').html(result);

                        //var gidArray = $("#shoppingCartGid").val();


                        //清空购物车
                        $.post("/Full/DeleteShoppingCart", {}, function (num) {
                            if (num != "0") {
                                //$(".number").html(0);
                                //$("#shoppingCartGid").val("");
                            }
                        });

                    });
                }

            });

        });

        //下载案例报告
        $("#caseReportDownload").click(function () {

            var caseReportId = $("input[name='caseReportId']").val();

            var url = "/Full/DownloadCaseReport";

            var form = $("<form></form>");
            form.attr('action', url);
            form.attr('method', 'post');
            form.attr('target', '_blank');

            form.append("<input name='caseReportId' value='" + caseReportId + "'/>");

            form.appendTo("body");
            form.css('display', 'none');
            form.submit();
            form.remove();
            return false;

        });





        //法宝词云点击
        $(".wordCloud").click(function () {
            //var isUserLogin = $("#IsUserLogin").val();
            ////用户未登录
            //if (isUserLogin != "true") {
            //    $("#loginBuyBtn").click();
            //    return false;
            //} else {
            //    var authorityType = $("#authorityType").val();
            //    if (authorityType != "ValidUser") {
            //        $("#loginAuthorityBtn").click();
            //        return false;
            //    }
            //}

            $U.showProgress();
            var keyword = $(this).text();
            if (keyword != "" & keyword != null) {
                var library = $("input[name='Library']").val();
                $.post("/law/Search/GetWordCloud", { keyword: keyword, library: library }, function (result) {

                    var jsonObj = eval('(' + result + ')');
                    if (jsonObj.data != "" && jsonObj.links != "") {
                        var cloudData = eval('(' + jsonObj.data + ')');
                        var cloudLinks = eval('(' + jsonObj.links + ')');

                        layer.open({
                            content: "<div id='wordcloudChart' style='width: 660px;height:530px;'></div>", //内容
                            area: ['700px', '620px'],

                            title: "法宝词云(双击节点跳转新检索)", //不要标题栏
                            fix: false, //不随滚动条滚动
                            move: false, //不可移动
                            btn: false, //按钮不展示           
                            shade: [0.01, '#000'],
                            success: function () {

                                $U.hideProgress();
                                var myChart = echarts.init(document.getElementById('wordcloudChart'));
                                $(myChart).show();

                                option = {
                                    //title: { text: keyword },
                                    tooltip: {
                                        formatter: function (x) {
                                            return x.data.des;
                                        }
                                    },
                                    series: [
                                        {
                                            type: 'graph',
                                            layout: 'force',
                                            //symbolSize: 80,
                                            roam: true,
                                            //edgeSymbol: ['circle', 'arrow'],
                                            edgeSymbolSize: [4, 10],
                                            edgeLabel: {
                                                normal: {
                                                    textStyle: {
                                                        fontSize: 20
                                                    }
                                                }
                                            },
                                            force: {
                                                repulsion: 600,
                                                edgeLength: [60, 80]
                                            },
                                            draggable: true,
                                            focusNodeAdjacency: false,
                                            itemStyle: {
                                                normal: {
                                                    color: '#4b565b'
                                                }
                                            },
                                            lineStyle: {
                                                normal: {
                                                    width: 2,
                                                    color: '#ccc'

                                                }
                                            },
                                            label: {
                                                normal: {
                                                    show: true,
                                                    textStyle: {
                                                        fontSize: 14,
                                                        //color: '#3c3c3c',
                                                        //fontWeight: 'bold'
                                                    }
                                                }
                                            },
                                            data: cloudData,
                                            links: cloudLinks

                                        }
                                    ]
                                };
                                myChart.setOption(option);
                                myChart.on('dblclick', function (params) {

                                    //http://localhost:7599/law/lar?Keywords=%E6%B3%95%E5%BE%8B&SearchKeywordType=Title
                                    var url = "http://" + window.location.host + "/law/" + library + "?Keywords=" + encodeURIComponent(params.value) + "&SearchKeywordType=Title";
                                    window.open(url);
                                });
                                //myChart.on('click', function (params) {

                                // //alert(1);
                                //});
                            }
                        });
                    }
                });
            }

        });

        //个人中心右上角快速检索
        $(".userCenterSelect > dl > dd").click(function () {

            var dd = $(this);

            var dl = $(this).parent();

            var filterProperty = dl.attr("prop");

            var filterItemName = filterProperty;

            var filterItemObj = $("input[name='" + filterItemName + "']");

            var filterItemValue = filterItemObj.val();

            var clickItemValue = dd.attr("filter_value");

            if (filterItemValue == clickItemValue) {
                return;
            }

            filterItemObj.val(clickItemValue);

            //结果中检索，关键词置空
            $("input[name='TitleKeywords']").val("");
            //列表分组项清空
            $("input[name='GroupValue']").val("");
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();

        });

        //导航的分组统计
        $("div.condition,#navbar").find("a[cluster_code]").click(function () {


            var curCli = $(this);

            var curClass = curCli.find('b').text();
            var curClassName = curClass.substring(0, curClass.length - 1);
            var curGroupName = $("#recordgroup").find(".currentSelect").text();
            var lib = $("input[name='Library']").val();

            if (curClassName.toLowerCase() == curGroupName.toLowerCase() || lib == "specialtopic") {

                $("input[name='ShowType']").val("Group");

            }


            var classCodeKey = $("input[name='ClassCodeKey']").val();

            //将分组值按，打节，
            var classCodeKeyArray = classCodeKey.split(",");

            //获取当前点击项的所属组索引
            var thisClickIndex = $(this).attr("cluster_index") * 1;


            classCodeKeyArray[thisClickIndex] = "";

            classCodeKey = classCodeKeyArray.join(",");

            //重新给分组统计项赋值
            $("input[name='ClassCodeKey']").val(classCodeKey);

            //结果中检索，关键词置空
            $("input[name='TitleKeywords']").val("");

            //列表分组项清空
            $("input[name='GroupValue']").val("");

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();
        });

        //导航的筛选项
        $("div.condition,#navbar").find("a[filter_value]").click(function () {

            var filterItemName = $(this).attr("prop");

            var filterItemObj = $("input[name='" + filterItemName + "']");

            filterItemObj.val("");


            if (filterItemName == "ExtCondition.GuidingCaseGid") {
                $("input[name='ExtCondition.GuidingCaseGid']").val("");
            }


            //结果中检索，关键词置空
            //$("input[name='TitleKeywords']").val("");
            //列表分组项清空
            //$("input[name='GroupValue']").val("");

            //分组置为初始化
            // $("input[name='ShowType']").val("Group");

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            //$("input[name='OrderByIndex']").val("0");
            //$("input[name='Keywords']").val("");

            $("#left_form").submit();

            $("#right_form").submit();
        });


        //导航的分组
        $("div.condition,#navbar").find("a[group_value]").click(function () {

            var groupIndex = $('input[name=GroupByIndex]').val();
            var orderIndex = $('#recordsort .currentSelect').attr('order_index');

            $("input[name='GroupValue']").val("");
            $("input[name='GroupByIndex']").val(groupIndex);
            $("input[name='ShowType']").val("Group");
            $("input[name='OrderByIndex']").val(orderIndex);
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();

        });

        //检索条件
        $("div.condition").find("a[filter_sort]").click(function () {

            var jsonStr = $("input[name='QueryBase64Request']").val();

            var restored = Base64.decode(jsonStr, { to: 'string' });


            //移除标签
            var isTitleRemove = $(this).attr("title");

            var filterSort = $(this).attr('filter_sort');

            var xClick = $(".condition").find("a[filter_sort=" + filterSort + "]");

            xClick.remove();

            if (isTitleRemove != "") {
                $("input[name='Keywords']").val("");
            }


            //移除隐藏域的条件
            var dataObj = eval("(" + restored + ")");
            var childs = dataObj.ChildNodes;
            childs.splice(filterSort, 1);
            dataObj.ChildNodes = childs;

            $("input[name='QueryBase64Request']").val(Base64.encode(JSON.stringify(dataObj)));

            var filterItemName = $(this).attr("prop");

            var filterItemObj = $("input[name='" + filterItemName + "']");

            filterItemObj.val("");

            //结果中检索，关键词置空
            // $("input[name='TitleKeywords']").val("");
            //列表分组项清空
            $("input[name='GroupValue']").val("");

            //分组置为初始化
            // $("input[name='ShowType']").val("Group");
            $("input[name='OrderByIndex']").val(0);
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();

        });

        //检索条件清除
        $("div.oparetion #btn-clear").click(function () {
            $("input[name='QueryBase64Request']").val("");
            $("input[name='ClassCodeKey']").val("");
            $("input[name='GroupValue']").val("");
            $("input[name^='FilterItems']").val("");
            $("input[name^='ExtCondition']").val("");
            $("input[name='OrderByIndex']").val("0");
            $("input[name='Keywords']").val("");

            $("#left_form").submit();

            $("#right_form").submit();


        });


        //检索条件的保存
        $("div.oparetion #btn-save").click(function () {
            //var isUserLogin = $("#IsUserLogin").val();
            ////用户未登录
            //if (isUserLogin != "true") {
            //    $("#loginBtn").click();
            //    return;
            //}

            var html = $("#saveCondition-div").html();
            layer.open({
                content: html, //内容
                area: '360px', //宽带400，高度自适应
                title: false, //不要标题栏
                fix: false, //不随滚动条滚动
                move: false, //不可移动
                btn: false, //按钮不展示
                shade: [0.01, '#000'], //遮罩透明度
                shadeClose: true //点击遮罩关闭弹框
            });

            $(".layui-layer-content #saveCondition-savebtn").unbind("click").click(function () {
                if ($(".layui-layer-content #filterName").val() == "") {
                    alert("名称不可以为空！");
                    return false;
                }

                $.ajax({
                    type: "GET",
                    url: $(".layui-layer-content #saveCondition-savebtn").attr("checkurl"),
                    data: { saveName: $(".layui-layer-content #filterName").val() },
                    success: function (result) {

                        $(".form #filterName").focus(function () {
                            $(".form .tips").hide();
                        });

                        if (result == "false") {
                            $(".form .tips").show();
                        } else {
                            var baseRequestValue = $("input[name='QueryBase64Request']").val();
                            var classCodeKey = $("input[name='ClassCodeKey']").val();
                            var filterValue = "";
                            var filterItem = $("#right_form").find("input[name^='FilterItems']");
                            $.each(filterItem, function (n, m) {
                                if (n + 1 < filterItem.length) {
                                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value + "$";
                                } else {
                                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value;
                                }

                            });
                            var extValue = "";
                            var extCondition = $("#right_form").find("input[name^='ExtCondition']");
                            $.each(extCondition, function (l, k) {
                                if (l + 1 < extCondition.length) {
                                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value + "$";
                                } else {
                                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value;
                                }
                            });
                            var matchType = $("input[name='MatchType']").val();

                            //名称+栏目+库别+QueryBase64Request+聚类+筛选+匹配方式+ExtCondition
                            var strFilter = $(".layui-layer-content #filterName").val() + "◆" + $("input[name='Menu']").val() + "◆" + $("input[name='Library']").val() + "◆" + baseRequestValue + "◆" + classCodeKey + "◆" + filterValue + "◆" + matchType + "◆" + extValue;

                            $.ajax(
                                {
                                    url: $("#saveCondition-savebtn").attr("url"),
                                    type: "POST",
                                    data:
                                    {
                                        filterValue: strFilter,
                                        library: $("#saveCondition-savebtn").attr("library")
                                    },

                                    success: function (data) {
                                        if (data == "ok") {
                                            layer.closeAll();
                                            layer.msg('保存成功！', {
                                                icon: 1,
                                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                            });
                                            return;
                                        } else {
                                            layer.closeAll();
                                            layer.msg('保存失败！', {
                                                icon: 1,
                                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                            });
                                            return;
                                        }

                                    }
                                });
                            return false;


                        }
                    }
                });


            });
        });

        //分享按钮
        $("div.oparetion #btn-sharewei").click(function () {
            //先保存 后分享
            var baseRequestValue = $("input[name='QueryBase64Request']").val();
            var classCodeKey = $("input[name='ClassCodeKey']").val();
            var filterValue = "";
            var filterItem = $("#right_form").find("input[name^='FilterItems']");
            $.each(filterItem, function (n, m) {
                if (n + 1 < filterItem.length) {
                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value + "$";
                } else {
                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value;
                }

            });

            var extValue = "";
            var extCondition = $("#right_form").find("input[name^='ExtCondition']");
            $.each(extCondition, function (l, k) {
                if (l + 1 < extCondition.length) {
                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value + "$";
                } else {
                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value;
                }
            });

            var matchType = $("input[name='MatchType']").val();

            var conditionName = "检索条件" + new Date().toLocaleDateString();

            //名称+栏目+库别+QueryBase64Request+聚类+筛选+匹配方式
            var strFilter = conditionName + "◆" + $("input[name='Menu']").val() + "◆" + $("input[name='Library']").val() + "◆" + baseRequestValue + "◆" + classCodeKey + "◆" + filterValue + "◆" + matchType + "◆" + extValue;

            $.ajax(
                {
                    url: $("#saveCondition-savebtn").attr("url"),
                    type: "POST",
                    data:
                    {
                        filterValue: strFilter,
                        library: $("#saveCondition-savebtn").attr("library"),
                        saveType: "share"
                    },

                    success: function (data) {
                        if (data != "no") {

                            var codeUrl = "http://" + window.location.host + "/" + $("input[name='Menu']").val() + "/condition/" + $("input[name='Library']").val() + "?recordId=" + data;

                            layer.open({
                                title: false,
                                btn: false,
                                shadeClose: true,
                                shade: 0.1,
                                area: ['200px', '230px'],
                                content: '<style>.layui-layer-dialog{min-width:195px!important;}.share-code{width: 155px;}.share-code.code{width:150px;}.share-code p{font-size: 12px;text-align: center;line-height: 18px;}</style><div class="share-code"><div class="code" id="qrcodeHolder"></div><p>用微信扫描二维码<br/>分享至好友或朋友圈</p></div>'
                            });
                            $('#qrcodeHolder').qrcode({
                                width: 159,
                                height: 150,
                                text: codeUrl
                            });
                            return;
                        } else {
                            layer.closeAll();
                            layer.msg('分享失败！', {
                                icon: 1,
                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                            });
                            return;
                        }

                    }
                });
        });

        //立法背景资料，这类多库的导航
        $("#ugly").find("a").click(function () {

            var library = $(this).attr("library");

            var grouplibraries = $(this).attr("grouplibraries");

            $("input[name='Library']").val(library);
            $("input[name='ClassFlag']").val(library);

            $("input[name='GroupLibraries']").val(grouplibraries);

            //清空所有的筛选项pagination

            $("div.clearFilterItems").empty();

            //回到首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();

        });

        $("#fblxtxtSearch").keypress(function (e) {
            var key = e.which; //e.which是按键的值 
            if (key == 13) {
                $("#fblxbtnSearch").click();
            }
        }).click(function (e) {
            e = e || window.event;
            if (e.stopPropagation) { //W3C阻止冒泡方法  
                e.stopPropagation();
            } else {
                e.cancelBubble = true; //IE阻止冒泡方法  
            }
        });

        //法宝联想点击其他引用图标
        $(".a-index-list").find(".c-bar").click(function () {

            var curBar = $(this);
            var curClass = curBar.attr("class");
            if (curClass == "c-icon c-bar c-bar-gray") {
                return false;
            } else {

                var gid = curBar.attr("gid");
                var lib = curBar.attr("lib");
                var myDiv = "<div id='otherbar' class='chart-bar' style='height:180px;'></div>";
                layer.open({
                    content: myDiv,
                    area: ['440px', '280px'],
                    title: '其他引用', //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示           
                    shade: [0.01, '#000'],
                    success: function () {
                        staticOtherQuoteBarChart(gid, lib);
                    }
                });
            }
            return true;
        });


        //法宝联想排序按钮点击
        $(".a-index-list").find("th a").click(function () {

            var curOrder = $(this);

            //点击显示当前隐藏其他的
            curOrder.find("i").css('visibility', 'visible');
            curOrder.parent().siblings().find("i").css('visibility', 'hidden');

            //根据点击的库别 修改排序字段 并提交表单
            var curOrderLib = curOrder.attr('order_lib'); //当前点击的排序库
            var curClinkLib = $("input[name='Library']").val(); //当前法宝联想库

            if (curClinkLib == "chl" || curClinkLib == "lar") {

                if (curOrderLib == "law") {
                    $("input[name='OrderByIndex']").val(6);
                } else if (curOrderLib == "case") {
                    $("input[name='OrderByIndex']").val(7);
                } else if (curOrderLib == "journal") {
                    $("input[name='OrderByIndex']").val(8);
                } else { //other
                    $("input[name='OrderByIndex']").val(9);
                }
            }

            if (curClinkLib == "eagn") {
                if (curOrderLib == "law") {
                    $("input[name='OrderByIndex']").val(3);
                } else if (curOrderLib == "case") {
                    $("input[name='OrderByIndex']").val(4);
                } else if (curOrderLib == "journal") {
                    $("input[name='OrderByIndex']").val(5);
                } else { //other
                    $("input[name='OrderByIndex']").val(6);
                }
            }

            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();


        });


        //历审文书点击
        $(".btn-list .history-btn").click(function () {
            var $link = $(this);
            var url = $link.attr('url');
            var off = $link.offset();
            off.top = off.top - $U.getViewPortScrollY();
            off.left = off.left;

            $.get(url, null, function (html) {

                layer.open({
                    content: html, //内容
                    area: '650px', //宽带400，高度自适应
                    offset: [off.top, off.left], //定位
                    title: false, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示
                    shade: [0.01, '#000'], //遮罩透明度
                    shadeClose: true //点击遮罩关闭弹框
                });

            });

        });

        //争议焦点  裁判依据点击
        $(".btn-list .FocusAndBasis").click(function () {
            var $link = $(this);
            var url = $link.attr('url');
            var off = $link.offset();
            off.top = off.top - $U.getViewPortScrollY();
            off.left = off.left;
            $.get(url, null, function (html) {

                layer.open({
                    content: html, //内容
                    area: '650px', //宽带400，高度自适应
                    offset: [off.top, off.left], //定位
                    title: false, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示
                    shade: [0.01, '#000'], //遮罩透明度
                    shadeClose: true //点击遮罩关闭弹框
                });

            });
        });


        //法宝联想其他引用统计方法
        var staticOtherQuoteBarChart = function (gid, lib) {
            var barChartOther = echarts.init(document.getElementById('otherbar'));
            barChartOther.showLoading({
                effect: 'ring',
                text: '图表正在加载中...'
            });
            var urlChartAuthor = virtualPath + "/api/chart/GetOtherQuoteBarChartData" + "?library=" + lib + "&gid=" + gid;
            // 指定图表的配置项和数据
            var barOption = {
                color: ['#3398DB'],
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        // 坐标轴指示器，坐标轴触发有效
                        type: 'none' // 默认为直线，可选为：'line' | 'shadow'
                    },
                    formatter: "{b} <br/>{a} : {c}%"
                },
                grid: {
                    left: '1%',
                    right: '1%',
                    bottom: '3%',
                    top: '3%',
                    containLabel: true
                },
                xAxis: [
                    {
                        type: 'category',
                        axisLine: {
                            lineStyle: {
                                color: '#c0c0c0'
                            }
                        },
                        axisTick: {
                            show: false
                        },
                        splitLine: {
                            //show: false

                        },
                        data: []
                    }
                ],
                yAxis: [
                    {
                        min: 0,
                        max: 100,
                        axisLabel: {
                            formatter: '{value}%'
                        },
                        axisLine: {
                            lineStyle: {
                                color: '#c0c0c0'
                            }
                        },
                        axisTick: {
                            show: false
                        },
                        splitLine: {
                            //show:false
                            lineStyle: {
                                color: '#f2f2f2'
                            }
                        },
                        type: 'value'
                    }
                ],
                series: [
                    {
                        name: '数量',
                        type: 'bar',
                        barWidth: '18',
                        itemStyle: {
                            // 系列级个性化
                            normal: {
                                color: '#85caf5'
                            },
                            emphasis: {
                                label: { show: false },
                                color: '#4cc5ff'
                            }
                        },
                        markPoint: {
                            //data: [
                            //    { type: 'max', name: '最大值' },
                            //    { type: 'min', name: '最小值' },
                            //    { type: 'average', name: '平均值' }
                            //],
                            label: {
                                normal: {
                                    textStyle: {
                                        fontSize: 10
                                    }
                                }
                            },
                            symbolSize: 60,
                            itemStyle: {
                                // 系列级个性化
                                normal: {
                                    color: '#fe901b'
                                }
                            },
                        },
                        data: [100, 52, 200, 334, 390, 330, 220, 390, 830, 220]
                    }
                ]
            };
            $.get(urlChartAuthor).done(function (result) {

                var nameArray = [];
                var valueArray = [];
                var totalValue = 0;
                var i = 0;
                if (result) {

                    $.each(result, function (n, m) {
                        totalValue += m.count;

                    });

                    $.each(result, function (n, m) {

                        nameArray[i] = m.name;


                        var num = (m.count / totalValue) * 100;

                        valueArray[i] = num.toFixed(2);
                        i++;

                    });


                }
                barOption.xAxis[0].data = nameArray;
                barOption.series[0].data = valueArray;
                barChartOther.hideLoading();
                barChartOther.setOption(barOption);
            });
        }


        //法宝联想检索框
        $("#fblxbtnSearch").click(function (e) {

            var txtSearch = $("#fblxtxtSearch");
            var q = $.trim(txtSearch.val());
            if (q.length == 0) {
                txtSearch.focus();
                e.preventDefault();
            }

            $("input[name='TitleKeywords']").val(q);
            //回到首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();
        });





        //筛选项下拉
        $(".filtrater").each(function () { $(this).Jselect(); });
        //筛选项
        $(".articleSelect > dl > dd").click(function () {

            var dd = $(this);

            var dl = $(this).parent();

            var filterProperty = dl.attr("prop");

            var filterItemName = "FilterItems." + filterProperty;

            var filterItemObj = $("input[name='" + filterItemName + "']");

            var filterItemValue = filterItemObj.val();

            var clickItemValue = dd.attr("filter_value");

            if (filterItemValue == clickItemValue) {
                return;
            }

            filterItemObj.val(clickItemValue);

            //结果中检索，关键词置空
            //$("input[name='TitleKeywords']").val("");

            //修改=>点击筛选项的时候不清空排序跟分组 2017.04.28 zyt
            var groupIndex = $('input[name=GroupByIndex]').val();
            var orderIndex = $('#recordsort .currentSelect').attr('order_index');
            $("input[name='GroupByIndex']").val(groupIndex);
            $("input[name='OrderByIndex']").val(orderIndex);
            var groupVal = $("#recordgroup .currentSelect").text();


            //列表分组项清空
            $("input[name='GroupValue']").val("");

            if (groupVal == "不分组" || groupVal == "") {
                $("input[name='ShowType']").val("Default");
            } else {
                $("input[name='ShowType']").val("Group");
            }

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            var searchType = $(".tab-nav .current a").attr("searchtype");
            if (searchType != undefined) {
                $("input[name='searchType']").val(searchType);
            }

            $("#left_form").submit();

            $("#right_form").submit();

        });

        //分组
        $(".grouping > a").click(function () {
            var a = $(this);

            var div = $(this).parent();

            var filterProperty = div.attr("prop");

            var filterItemName = "FilterItems." + filterProperty;

            var filterItemObj = $("input[name='" + filterItemName + "']");

            var filterItemValue = filterItemObj.val();

            var clickItemValue = a.attr("filter_value");

            if (filterItemValue == clickItemValue) {
                return;
            }
            filterItemObj.val(clickItemValue);

            //结果中检索，关键词置空
            $("input[name='TitleKeywords']").val("");
            //列表分组项清空
            $("input[name='GroupValue']").val("");
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();
        });


        $('.filtrater dd').addClassHover();


        //记录排序
        $("#recordsort > a").click(function () {


            $("input[name='AfterSearch']").val('False');
            var is_group = $(this).attr("is_group");
            var groupIndex = $("#recordgroup .currentSelect");
            var groupIndexVal = groupIndex.attr("group_index");
            var groupText = groupIndex.text();

            //分组的情况，分组索引
            if (is_group == "True") {
                $("input[name='GroupByIndex']").val($(this).attr("order_index"));
                $("input[name='ShowType']").val("Group");
                $("input[name='OrderByIndex']").val(0);
            } else if (is_group == "False") {
                if (groupText == "不分组") { //无分组

                    $("input[name='GroupByIndex']").val(groupIndexVal);
                    $("input[name='ShowType']").val("Default");
                } else {

                    if (groupIndex.length > 0) { //有分组项
                        $("input[name='GroupByIndex']").val(groupIndexVal);
                        $("input[name='ShowType']").val("Group");
                        $("input[name='GroupValue']").val(""); //清空更多
                    }
                }


                var orderIndexObj = $("input[name='OrderByIndex']");

                //var currentOrderIndex = orderIndexObj.val();

                var orderIndex = $(this).attr("order_index");

                //if (currentOrderIndex == orderIndex) {
                //    return;
                //}

                orderIndexObj.val(orderIndex);
                //$("input[name='ShowType']").val("Default");
                //$("input[name='GroupByIndex']").val(0);
            }


            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();

        });

        //个人中心自定义案例报告筛选项
        $(".specialSelect > dl > dd").click(function () {

            var dd = $(this);

            var dl = $(this).parent();

            var filterProperty = dl.attr("prop");

            var filterItemName = "FilterItems." + filterProperty;

            var filterItemObj = $("input[name='" + filterItemName + "']");

            var filterItemValue = filterItemObj.val();

            var clickItemValue = dd.attr("filter_value");

            if (filterItemValue == clickItemValue) {
                return;
            }

            filterItemObj.val(clickItemValue);

            var orderIndex = $('#recordsort .currentSelect').attr('order_index');

            $("input[name='OrderByIndex']").val(orderIndex);

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();
            //$("#CaseReportForm").submit();

        });

        //个人中心自定义案例报告排序
        $("#specialsort > a").click(function () {

            var orderIndexObj = $("input[name='OrderByIndex']");

            var orderIndex = $(this).attr("order_index");

            orderIndexObj.val(orderIndex);


            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();
            //$("#CaseReportForm").submit();

        });

        //分组
        $("#recordgroup >a").click(function () {

            var groupIndex = $(this).attr("group_index");
            var showName = $(this).text();
            var orderIndex = $("#recordsort .currentSelect");
            var orderIndexVal = orderIndex.attr("order_index");

            if (showName == "不分组" || showName == "List View") { //无分组
                $("input[name='GroupByIndex']").val(groupIndex);
                $("input[name='ShowType']").val("Default");
            } else {
                $("input[name='GroupByIndex']").val(groupIndex);
                $("input[name='ShowType']").val("Group");
                $("input[name='OrderByIndex']").val(orderIndexVal);

            }

            $("input[name='GroupValue']").val("");

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();
        });


        //分组效果
        $('.team').addClassHover();
        $('.team a').sortChang();

        //排序效果
        $('.sort').addClassHover();
        $('.sort a').sortChang();


        //分组按钮 保留 高级检索里英文会用到
        $("#recordGroup [name='ckbShowType'] ").click(function () {
            if ($(this).is(':checked')) {
                $("input[name='GroupByIndex']").val(0);
                $("input[name='ShowType']").val("Group");
                //$("input[name='OrderByIndex']").val(0);
            } else {
                $("input[name='ShowType']").val("Default");
                $("input[name='GroupByIndex']").val(0);
            }
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();
        });

        //列表分组更多
        $(".grouping-title a[groupvalue]").click(function () {
            //var groupvalue = $(this).attr("groupvalue");
            //$("input[name='GroupValue']").val(groupvalue);
            //var classcodekey = $("input[name='ClassCodeKey']").val();
            //var classCodeKeyArray = classcodekey.split(",");
            //var groupbyindex = $("input[name='GroupByIndex']").val();
            //if (groupbyindex == "0") {
            //    classCodeKeyArray[3] = groupvalue;
            //    classcodekey = classCodeKeyArray.join(",");
            //    $("input[name='ClassCodeKey']").val(classcodekey);
            //}
            //if (groupbyindex == "1") {

            //}
            //$("input[name='ShowType']").val("Default");
            ////$("input[name='OrderByIndex']").val(0);
            //$("input[name='Pager.PageIndex']").val(0);

            //$("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());


            //$("#right_form").submit();
            var groupvalue = $(this).attr("groupvalue");
            $("input[name='GroupValue']").val("");

            $("input[name='ShowType']").val("Default");
            //$("input[name='OrderByIndex']").val(0);
            $("input[name='Pager.PageIndex']").val(0);
            var isAdv = $("input[name='IsAdv']").val();

            $("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());

            //获取当前点击项的所属组索引（法规聚类相关提示特殊处理）
            var thisClickIndex = "";
            thisClickIndex = $(this).attr("clusterIndex") * 1;
            //获取分组统计项值
            var classCodeKey = $("input[name='ClassCodeKey']").val();
            //将分组值按，打节，
            var classCodeKeyArray = classCodeKey.split(",");
            classCodeKeyArray[thisClickIndex] = groupvalue;
            classCodeKey = classCodeKeyArray.join(",");
            //重新给分组统计项赋值
            $("input[name='ClassCodeKey']").val(classCodeKey);
            $("#right_form").submit();
            $("#left_form").submit();
            var isFblx = $("input[name='isFblx']").val();
            var classCodeKey = $("#left_form input[name='ClassCodeKey']").val();
            //if (isFblx != undefined && isFblx != "") {//法宝联想聚类点击
            //    ClassResultSearch.FblxClassResultInit(classCodeKey);
            //} else {
            //    //针对法宝联想做处理
            //    if ($("input[name='isFblx']").val() == "true") {
            //        $("#left_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());

            //        $("#left_form").find("input[name='Keywords']").val($("#right_form").find("input[name='Keywords']").val());
            //    }
            //    ClassResultSearch.CaseClassResultInit(classCodeKey);
            //}



            if (isAdv != "True") {
                $("#subLib_form").submit();
            }

        });

        //列表底部分组更多
        $(".more a[groupvalue]").click(function () {
            //var groupvalue = $(this).attr("groupvalue");
            //$("input[name='GroupValue']").val(groupvalue);

            //$("input[name='ShowType']").val("Default");
            ////$("input[name='OrderByIndex']").val(0);
            //$("input[name='Pager.PageIndex']").val(0);

            //$("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());


            //$("#right_form").submit();
            var groupvalue = $(this).attr("groupvalue");
            $("input[name='GroupValue']").val("");

            $("input[name='ShowType']").val("Default");
            //$("input[name='OrderByIndex']").val(0);
            $("input[name='Pager.PageIndex']").val(0);
            var isAdv = $("input[name='IsAdv']").val();
            //获取当前点击项的所属组索引（法规聚类相关提示特殊处理）
            var thisClickIndex = "";
            thisClickIndex = $(this).attr("clusterIndex") * 1;
            //获取分组统计项值
            var classCodeKey = $("input[name='ClassCodeKey']").val();
            //将分组值按，打节，
            var classCodeKeyArray = classCodeKey.split(",");
            classCodeKeyArray[thisClickIndex] = groupvalue;
            classCodeKey = classCodeKeyArray.join(",");
            //重新给分组统计项赋值
            $("input[name='ClassCodeKey']").val(classCodeKey);
            $("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());
            $("#right_form").submit();
            $("#left_form").submit();
            var isFblx = $("input[name='isFblx']").val();
            var classCodeKey = $("#left_form input[name='ClassCodeKey']").val();

            //if (isFblx != undefined && isFblx != "") {//法宝联想聚类点击
            //    ClassResultSearch.FblxClassResultInit(classCodeKey);
            //} else {
            //    //针对法宝联想做处理
            //    if ($("input[name='isFblx']").val() == "true") {
            //        $("#left_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());

            //        $("#left_form").find("input[name='Keywords']").val($("#right_form").find("input[name='Keywords']").val());
            //    }
            //    ClassResultSearch.CaseClassResultInit(classCodeKey);
            //}

            if (isAdv != "True") {//高级检索没有子库查询
                $("#subLib_form").submit();
            }

        });


        $('#subKeywords').keypress(function (e) {
            var key = e.which; //e.which是按键的值 
            if (key == 13) {
                $("#btnSubSearch").click();
            }
        }).click(function (e) {
            e = e || window.event;
            if (e.stopPropagation) { //W3C阻止冒泡方法  
                e.stopPropagation();
            } else {
                e.cancelBubble = true; //IE阻止冒泡方法  
            }
        });


        //在结果中检索
        $("#btnSubSearch").click(function () {

            var Menu = $("input[name='Menu']").val();
            if (Menu != undefined && (Menu == "case" || Menu == "procuratorate")) {
                //var isUserLogin = $("#IsUserLogin").val();
                ////用户未登录
                //if (isUserLogin != "true") {
                //    $("#loginBtn").click();
                //    return false;
                //}
            }
            //法宝联想
            var referenceGid = $("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val();
            $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val(referenceGid);


            var newKeywords = $("#subKeywords").val(); //当前输入的搜索内容          

            //如果没变，则不动，讲究一个敌不动，我不动。
            if ($.trim(newKeywords).length == 0) {
                return;
            }
            $("input[name='Keywords']").val(newKeywords);

            $("input[name='GroupValue']").val("");

            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();

        });

        //关键词展开命中
        $(".search-hit-box").each(function () {

            //
            var hitBox = $(this);

            //当前条的gid
            var gidFlag = $(this).attr("flag");

            //当前条对应的全文链接
            var fullTextUrl = $(this).siblings("div").first().find("a[flink]").attr("href");
            var expandUrl = $(this).find(".more-hit a").attr("url");
            var HadExpandText = "收起命中", NoExpandText = "展开命中";

            var lib = $("input[name='Library']").val();

            var libSub = lib.substring(0, 3);


            if (libSub == "en_") {

                HadExpandText = "Collapse", NoExpandText = "Expand";
            }


            //第一条命中
            var firstRecordContainer = hitBox.find("p[flag='" + gidFlag + "']");

            //展开命中按钮的容器
            var btnContainer = hitBox.find("div.more-hit[flag='" + gidFlag + "']");

            //分页容器
            var pagecontainer = hitBox.find("div.page[flag='" + gidFlag + "']");

            //展开命中按钮
            var showHitBtn = hitBox.find(".btn");

            var perpage = 5;

            //展开之后要执行的方法
            var afterExpandFun = function () {

                var _ulContainer = hitBox.find("ul[flag='" + gidFlag + "']");

                if (_ulContainer.length > 0) {

                    //_ulContainer.show();
                    _ulContainer.slideDown("slow");

                    if (_ulContainer.children().length > perpage) {

                        pagecontainer.show();
                    }

                    showHitBtn.text(HadExpandText);

                    firstRecordContainer.hide();

                }
            };

            //展开命中点击事件
            showHitBtn.click(function () {

                var btn = $(this);

                var thisText = btn.text();
                //如果是点击的“展开命中”
                if (thisText == NoExpandText) {

                    if (hitBox.find("ul[flag='" + gidFlag + "']").length > 0) {
                        afterExpandFun();
                        return;
                    }

                    $.ajax({
                        beforeSend: function () {
                            btn.attr("disabled", true);
                        },
                        type: "POST",
                        url: btn.attr("url"),
                        data: { queryJson: $("input[name='QueryBase64Request']").val() },
                        dataType: "JSON",
                        success: function (data) {
                            if (data.length > 0) {
                                var ulDom = $("<ul flag='" + gidFlag + "'></ul>");

                                btnContainer.before(ulDom);
                                ulDom.hide();
                                $.each(data, function (i, item) {
                                    //var reg = new RegExp("keyword=([^&]*)(&|$)");
                                    //var p = fullTextUrl.match(reg);
                                    //var l = expandUrl.match(reg);
                                    //var curFullTextUrl = fullTextUrl;
                                    //if (p != null && l != null) {

                                    //    curFullTextUrl = fullTextUrl.replace(p[1], l[1]);
                                    //} else {
                                    //    curFullTextUrl = fullTextUrl + "?keyword=" + l[1];

                                    //}
                                    var curFullTextUrl = fullTextUrl;

                                    if (curFullTextUrl.indexOf("keyword") > 0) {

                                        curFullTextUrl = curFullTextUrl + "&tiao=" + (item.HitIndex + 1);
                                    }

                                    ulDom.append(
                                        "<li> <a target='_blank' href='" + curFullTextUrl + "'>" + item.Content + "</a></li>"
                                    );
                                });
                                ulDom.slideDown("slow");

                                if (data.length <= perpage) {

                                    //ulDom.height(data.length * 64);

                                } else {

                                    ulDom.find("li").quickpaginate({
                                        perpage: perpage,
                                        pager: pagecontainer,
                                        showall: false
                                    });
                                }

                                afterExpandFun();
                            }
                        },
                        complete: function () {
                            btn.removeAttr("disabled");
                        }
                    });
                } else { //如果点击的是“收起命中”

                    hitBox.find("ul[flag='" + gidFlag + "']").slideUp("slow");

                    pagecontainer.hide();

                    firstRecordContainer.show();

                    btn.text(NoExpandText);
                }

            });

        });

        //分页控件
        $(".pagination li").not("[class]").click(function () {

            var btn = $(this);
            var type = typeof (btn);
            var name = $(this).find("input").attr("name");
            if (name == "jumpToNum") {
                return;
            }
            var text = btn.text();
            var menu = $("input[name='Menu']").val();
            var re = /^[0-9]+.?[0-9]*$/;
            var jumpToNum = $("input[name='jumpToNum']").val();

            var pagerIndexObj = $("input[name='Pager.PageIndex']");
            var pagerPageSize = $("#right_form>input[name='Pager.PageSize']").val();

            var pagerIndex = (pagerIndexObj.val() * 1);

            var newpagerIndex = ($(this).find("a").attr("pageindex") * 1) - 1;
            if ((text == "确定" || text == "Go") && jumpToNum.trim() != "") {
                newpagerIndex = parseInt(jumpToNum) - 1;

            }
            var lastPageIndex = 0;
            $(".pagination>li>a").each(function () {
                if ($(this).text() == "尾页" || $(this).text() == "Last") {
                    lastPageIndex = $(this).attr("pageindex");
                }
            })
            if (newpagerIndex >= parseInt(lastPageIndex)) {

                var htmlcontent = "<div class=\"layer-wrap\"><h4 class=\"title\">温馨提示</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">尊敬的用户，您好！<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;抱歉，您输入的数字超出最大允许翻页数。如果您对检索结果不满意，请修改检索条件进行尝试。</p><div style=\"margin-top:40px;\"><div style=\"text-align:center;margin:0\" class=\"btn-wrap\"><a href=\"javascript:void(0);\" style=\" width: 142px;height: 38px;font-size: 16px;color: white;background: #218fc4;\" onclick=\"layer.closeAll();\" id=\"btnhulue\">确定</a></div></div></div></div>";
                if (menu == "english") {
                    htmlcontent = "<div class=\"layer-wrap\"><h4 class=\"title\">Tips</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">Dear users:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sorry, the number you entered has exceeded the maximum number of pages allowed for turning.If you are not satisfied with the search results, please change the search conditions to try again.</p><div style=\"margin-top:40px;\"><div style=\"text-align:center;margin:0\" class=\"btn-wrap\"><a href=\"javascript:void(0);\" style=\" width: 142px;height: 38px;font-size: 16px;color: white;background: #218fc4;\" onclick=\"layer.closeAll();\" id=\"btnhulue\">OK</a></div></div></div></div>";
                }
                layer.open({
                    content: htmlcontent, //内容 
                    area: menu == "english" ? ['560px', '310px'] : ['520px', '290px'], //宽带400，高度自适应
                    title: false, //不要标题栏
                    fix: true, //不随滚动条滚动
                    move: true, //不可移动
                    btn: false, //按钮不展示
                    shade: 0.5, //遮罩透明度
                    shadeClose: false, //点击遮罩关闭弹框
                    cancel: function (index, layero) {


                        $("#newPageIndex").val("");
                        $("input[name='Pager.PageIndex']").val($("input[name='OldPageIndex']").val());
                    }
                });
                $("input[name='jumpToNum']").val("");
                return;
            }

            //如果没变，则不动，讲究一个敌不动，我不动。
            if (pagerIndex == newpagerIndex) {
                return;
            }
            $("#newPageIndex").val(newpagerIndex);
            //获取限制页数
            $.ajax({
                url: "/VerificationCode/GetRecordListTurningLimit",
                type: "POST",
                datatype: 'text',
                async: false,
                success: function (pageLimit) {

                    //翻页页数达到限制，进行弹窗验证
                    if (newpagerIndex >= pageLimit) {

                        var isPc = isPcDevice();
                        var url = isPc ? "/VerificationCode/VerificationCodePage" : "/ClickVerify/ClickVerifyPage";
                        $.ajax({
                            url: url, //弹出验证码窗口
                            type: "POST",
                            async: false,
                            beforeSend: function () {
                                console.log("fefore");
                                AjaxRequestFun.ajaxBegin();
                            },
                            complete: function () {
                                console.log("complete");
                                AjaxRequestFun.ajaxComplete();
                            },
                            error: function () {
                                console.log("error");
                                AjaxRequestFun.ajaxFailure();
                            },
                            success: function (html) {
                                $("input[name='OldPageIndex']").val(pagerIndex);
                                pagerIndexObj.val(newpagerIndex);
                                $("input[name='PageIndex']").val(newpagerIndex);
                                layer.open({
                                    content: html, //内容 
                                    area: isPc ? ['340px', '274px'] : ['440px', '240px'], //宽带400，高度自适应
                                    title: false, //不要标题栏
                                    fix: true, //不随滚动条滚动
                                    move: true, //不可移动
                                    btn: false, //按钮不展示
                                    shade: 0.5, //遮罩透明度
                                    shadeClose: false, //点击遮罩关闭弹框
                                    cancel: function (index, layero) {
                                        $("#newPageIndex").val("");
                                        $("input[name='Pager.PageIndex']").val($("input[name='OldPageIndex']"));
                                    }
                                });


                            }

                        });
                    } else {

                        //正常翻页
                        $("input[name='OldPageIndex']").val(pagerIndex);
                        pagerIndexObj.val(newpagerIndex);
                        $("input[name='PageIndex']").val(newpagerIndex);
                        var searchType = $(".tab-nav .current a").attr("searchtype");
                        if (searchType != undefined) {
                            $("input[name='searchType']").val(searchType);
                        }
                        $("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());

                        $("#right_form").submit();
                    }
                }
            });

        });

        function isPcDevice() {
            if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {
                /*window.location.href="你的手机版地址";*/
                return false;
            } else {
                /*window.location.href="你的电脑版地址";    */
                return true;
            }
        }

        //引用统计权限判断
        $("a.citeStat").each(function () {
            $(this).click(function () {
                //var isUserLogin = $("#IsUserLogin").val();
                ////用户未登录
                //if (isUserLogin != "true") {
                //    $("#loginBuyBtn").click();
                //    return false;
                //} else {//判断权限类型
                //    var authorityType = $("#authorityType").val();
                //    if (authorityType != "ValidUser") {
                //        $("#loginAuthorityBtn").click();
                //        return false;
                //    }
                //}
            });
        });

        //背景资料，本法变迁  
        $(".isHaveExt").click(function () {
            var $link = $(this);
            var off = $link.offset();
            off.top = off.top - $U.getViewPortScrollY();
            off.left = off.left - 400;
            var url = $link.attr("url");
            $.get(url, null, function (html) {
                var verifyLayer = layer.open({
                    content: html,//内容
                    area: '650px',//宽带400，高度自适应
                    offset: [off.top, off.left],//定位
                    title: false,//不要标题栏
                    fix: false,//不随滚动条滚动
                    move: false,//不可移动
                    btn: false,//按钮不展示
                    shade: [0.01, '#000'],//遮罩透明度
                    shadeClose: true//点击遮罩关闭弹框
                });

                $(".layer-wrap a").click(function () {
                    if ($link.text() == "本法变迁") {
                        //var isUserLogin = $("#IsUserLogin").val();
                        ////用户未登录
                        //if (isUserLogin != "true") {
                        //    $("#loginBuyBtn").click();
                        //    return false;
                        //} else {//判断权限类型
                        //    var authorityType = $("#authorityType").val();
                        //    if (authorityType != "ValidUser") {
                        //        $("#loginAuthorityBtn").click();
                        //        return false;
                        //    }
                        //}
                    }
                });


            });

        });

        //法宝联想弹框
        $(".isHaveAssociation").click(function () {
            var $link = $(this);
            var off = $link.offset();
            off.top = off.top - $U.getViewPortScrollY();
            off.left = off.left - 400;
            var url = $link.attr("url");
            $.get(url, null, function (html) {

                if (html == "") {
                    html = "暂无数据！";
                }
                layer.open({
                    content: html,//内容
                    area: '650px',//宽带400，高度自适应
                    offset: [off.top, off.left],//定位
                    title: false,//不要标题栏
                    fix: false,//不随滚动条滚动
                    move: false,//不可移动
                    btn: false,//按钮不展示
                    shade: [0.01, '#000'],//遮罩透明度
                    shadeClose: true//点击遮罩关闭弹框
                });

            });

        });


        //点击更多
        $(".author-list .title .more").click(function () {

            var filterVaule = $(this).attr("filterValue");
            $("input[name='ExtCondition.AuthorPy']").val(filterVaule);
            $("input[name='ExtCondition.UnitPy']").val(filterVaule);
            $("input[name='ShowType']").val('Default');
            $("#right_form").submit();

            return false;

        });

        //专题参考书籍展示方式
        $(".view-type > a").click(function () {
            var a = $(this);

            var clickItemValue = a.attr("filter_value");
            var filterItemValue = $("input[name='displayType']").val();

            if (filterItemValue == clickItemValue) {
                return;
            }

            $("input[name='displayType']").val(clickItemValue);

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);
            $("#right_form").submit();
        });

        $('.view-type a').imagesType();

        //筛选项判断分辨率及数量是否 > 3
        $('.list-filtrater').filtraterWidth();

        //下载目录
        $(".downloadCatalogue").fulltextDown();

        //个人中心 消息点击全部
        $(".tool-bar .tool .c-all").click(function () {

            $("#right_form").find("[name='MsgType']").remove();
            $("#right_form").submit();

        });
        //个人中心 消息点击推荐
        $(".tool-bar .tool #recomend").click(function () {

            $("input[name='Pager.PageIndex']").val(0);
            $("#right_form").find("[name='MsgType']").val("Rcommend");
            $("#right_form").submit();

        });
        //个人中心 消息点击账户通知
        $(".tool-bar .tool #inform").click(function () {

            $("input[name='Pager.PageIndex']").val(0);
            $("#right_form").find("[name='MsgType']").val("Notice");
            $("#right_form").submit();

        });
        //个人中心 消息点击删除
        $(".tool-bar .tool .btn-delete").click(function () {
            var form = $("#right_form");
            form.find("#opType").val("delete");
            var ids = "";

            $("div.table tr td input[type='checkbox']:checked").each(function (i, item) {
                ids += $(item).attr("id") + ",";
            });
            if (ids == "") {
                alert("请先勾选需要设置的项目");
                return false;
            }
            form.find("#ids").val(ids);
            form.attr("action", $("#msgOpUrl").val());
            form.submit();
        });
        //个人中心 消息点击已读
        $(".tool-bar .tool .btn-readed").click(function () {
            var form = $("#right_form");
            form.find("#opType").val("readed");
            var ids = "";

            $("div.table tr td input[type='checkbox']:checked").each(function (i, item) {
                ids += $(item).attr("id") + ",";
            });
            if (ids == "") {
                alert("请先勾选需要设置的项目");
                return false;
            }
            form.find("#ids").val(ids);
            form.attr("action", $("#msgOpUrl").val());
            //form.attr("data-ajax-success", test());
            form.submit();

        });


        //个人中心 全选
        $("div.table #chkAll").click(function () {


            $("div.table tr td input[type='checkbox']").prop('checked', $(this).prop('checked'));
        });
        //个人中心 收藏删除
        $("div.table .deleteadd").click(function () {
            var form = $("#right_form");
            var me = $(this);
            $("#hidRecordId").val(me.attr("id"));
            form.attr("action", $("#deleteUrl").val());
            var searchType = $(".tab-nav .current a").attr("searchtype");
            if (searchType != undefined) {
                $("input[name='searchType']").val(searchType);
            }
            form.submit();
        });
        //个人中心 检索删除
        $("div.table .btn").click(function () {
            var form = $("#right_form");
            var me = $(this);
            $("#hidRecordId").val(me.attr("id"));
            form.attr("action", $("#deleteUrl").val());
            var searchType = $(".tab-nav .current a").attr("searchtype");
            if (searchType != undefined) {
                $("input[name='searchType']").val(searchType);
            }
            form.submit();
        });
        $(".btn-Consent").click(function () {
            var isEng = $("#isEng").val();
            if (isEng == "True") {
                if (!confirm("Are you sure?")) {
                    return false;
                }
            } else {
                if (!confirm("确定同意？")) {
                    return false;
                }
            }

            var msg;
            var userApplyJoinGroupId = $(this).siblings("input[name='hidValue']").val();
            $.ajax({
                type: "POST",
                cache: false,
                url: "/UserCenter/BindManagerOperation",
                dataType: "text",
                data: { "BindMessage": 1, "UserApplyJoinGroupId": userApplyJoinGroupId },
                async: false,
                success: function (data) {
                    msg = data;
                }
            });
            if (msg == "ok") {
                window.location.href = "/UserCenter/BindAccountManager";
            } else {
                alert("获取用户信息失败！");
            }
        });

        $(".btn-unConsent").click(function () {
            if (!confirm("确定不同意？")) {
                return false;
            }
            var msg;
            var userApplyJoinGroupId = $(this).siblings("input[name='hidValue']").val();
            $.ajax({
                type: "POST",
                cache: false,
                url: "/UserCenter/BindManagerOperation",
                dataType: "text",
                data: { "BindMessage": 2, "UserApplyJoinGroupId": userApplyJoinGroupId },
                async: false,
                success: function (data) {
                    msg = data;
                }
            });
            if (msg == "ok") {
                window.location.href = "/UserCenter/BindAccountManager";
            } else {
                alert("获取用户信息失败！");
            }
        });
        $(".btn-Relieve").click(function () {
            if (!confirm("确定解除绑定？")) {
                return false;
            }
            var msg;
            var Id = $(this).siblings("input[name='hidValue']").val();
            $.ajax({
                type: "POST",
                cache: false,
                url: "/UserCenter/BindManagerOperation",
                dataType: "text",
                data: { "BindMessage": 3, "UserApplyJoinGroupId": Id },
                async: false,
                success: function (data) {
                    msg = data;
                }
            });
            if (msg == "ok") {
                $(".binders > a[filter_value='havebind']").click();
            }
        });
        //绑定和未绑定的选择
        $(".binders > a").click(function () {
            var filterItemName = "FilterItems.BindState";
            var filterItemObj = $("input[name='" + filterItemName + "']");
            var filterItemValue = filterItemObj.val;
            var clickItemValue = $(this).attr("filter_value");
            if (filterItemValue == clickItemValue) {
                return;
            }
            filterItemObj.val(clickItemValue);
            //结果中检索，关键词置空
            $("input[name='TitleKeywords']").val("");
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();
        });
        //绑定管理页搜索
        $(".userSearch").click(function () {
            var serachName = $("input[name='TitleKeywords']").val();
            $("input[name='SearchName']").val(serachName);
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);
            $("#left_form").submit();

            $("#top_form").submit();
        });

        //个人中心 搜索记录tab切换事件
        $(".tab-nav a").click(function () {
            $(this).parent().addClass("current");
            $(this).parent().siblings().removeClass("current");
            // alert($(this).attr("searchType"));
            var searchType = $(this).attr("searchType");
            var filterItem = $("#articleSelect").find("dl .currentSelect");
            var filterProperty = filterItem.attr("prop");
            var filterItemName = "FilterItems." + filterProperty;
            var filterItemObj = $("input[name='" + filterItemName + "']");
            var clickItemValue = filterItem.attr("filter_value");
            filterItemObj.val(clickItemValue);
            $("input[name='searchType']").val(searchType);
            $("input[name='Pager.PageIndex']").val(0);
            $("#right_form").submit();


        });

        //专题参考 首页推荐更多
        $(".block-list .title").find("a.more").click(function () {

            var code = $(this).attr("code") + ",,,";
            $("input[name='ClassCodeKey']").val(code);
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            var lib = $("input[name='Library']").val();

            if (lib == "specialtopic") {
                $("input[name='ShowType']").val("Default");
            }

            $("#left_form").submit();

            $("#right_form").submit();

        });

        //语音播放功能
        /**
         * 列表页、正文页，无论是否登录都可以看到播放小喇叭
         * 没登录的点击小喇叭，提示必须登录
         * 已登录的，只有部分权限的，正文有多少读多少，并且读出登录注册等提示语；有完全权限的可以读取全文
         * 播放内容页面是全新的页面，正文按句号分割，并且标序号，点哪读哪，读取文本有红色标识
         */

        //var cuid = "B1D2Y3H4";
        //var tok = "";
        //var size = 500;
        //var index = 0;
        //var ttssrc = "";
        //var audio = $("#ttsaudio")[0];
        //var flag = true;
        //var fullContent = "";
        //var historyAudio = "";
        //var clickAudio;

        //$(".btnAudio").click(function () {
        //    var defaultVersion = 8.0;
        //    var ua = navigator.userAgent.toLowerCase();
        //    var isIe = ua.indexOf("msie") > -1;
        //    var safariVersion = "";
        //    if (isIe) {
        //        safariVersion = ua.match(/msie ([\d.]+)/)[1];
        //    }
        //    if (safariVersion != "" && safariVersion <= defaultVersion) {

        //        layer.msg('请升级到IE9及以上版本，或者使用chrome和火狐浏览器。', {
        //            icon: 0
        //        });
        //    } else {
        //        clickAudio = $(this);
        //        var curAudio = $(this).attr("audioGid");

        //        if (tok == "" && ttssrc == "") {
        //            $.ajax({
        //                url: "/Tool/GetAudioToken",
        //                type: "Get",
        //                async: false,
        //                success: function (data) {
        //                    if (data != "") {
        //                        var dataObj = eval("(" + data + ")");
        //                        tok = dataObj.access_token;
        //                        ttssrc = "https://tsn.baidu.com/text2audio?" + "lan=zh&cuid=" + cuid + "&aue=3&ctp=1&tok=" + tok + "&tex=";
        //                    }
        //                }
        //            });
        //        }
        //        if (flag) {
        //            $.ajax({
        //                url: "/Full/GetAudioFulltext?library=" + $("input[name='Library']").val() + "&gid=" + curAudio,
        //                type: "Get",
        //                success: function (data) {
        //                    if (data != "") {
        //                        var dataObj = eval("(" + data + ")");
        //                        fullContent = delHtmlTag(dataObj);
        //                        if (fullContent != "" && fullContent != null) {
        //                            if (audio.paused) {
        //                                if (flag) {
        //                                    if (fullContent.length > size) {
        //                                        var newFullContent = fullContent.substr(0, size);
        //                                        audio.src = ttssrc + encodeURIComponent(newFullContent);
        //                                    } else {
        //                                        audio.src = ttssrc + fullContent;
        //                                        size = fullContent.length;
        //                                    }

        //                                    flag = false;
        //                                    historyAudio = curAudio;
        //                                }
        //                                clickAudio.addClass("current");
        //                                audio.play();
        //                            } else {
        //                                $(".voice").removeClass("current");
        //                                audio.pause();
        //                            }
        //                        }
        //                    }
        //                }
        //            });
        //        } else {//两种情况 第一点击原按钮暂停当前播放 点击了其他播放按钮 开始新的播放
        //            $(".voice").removeClass("current");
        //            audio.pause();
        //            flag = true;
        //            if (curAudio != historyAudio) {
        //                $.ajax({
        //                    url: "/Full/GetAudioFulltext?library=" + $("input[name='Library']").val() + "&gid=" + curAudio,
        //                    type: "Get",
        //                    success: function (data) {
        //                        if (data != "") {
        //                            var dataObj = eval("(" + data + ")");
        //                            fullContent = delHtmlTag(dataObj);
        //                            if (fullContent != "" && fullContent != null) {
        //                                if (audio.paused) {
        //                                    if (flag) {
        //                                        if (fullContent.length > size) {
        //                                            var newFullContent = fullContent.substr(0, size);
        //                                            audio.src = ttssrc + encodeURIComponent(newFullContent);
        //                                        } else {
        //                                            audio.src = ttssrc + fullContent;
        //                                            size = fullContent.length;
        //                                        }

        //                                        flag = false;
        //                                        historyAudio = curAudio;
        //                                    }
        //                                    clickAudio.addClass("current");
        //                                    audio.play();
        //                                } else {
        //                                    $(".voice").removeClass("current");
        //                                    audio.pause();
        //                                }
        //                            }
        //                        }
        //                    }
        //                });
        //            }
        //        }
        //    }




        //});
        //audio.onended = function () {
        //    index = index + size;
        //    if (index < fullContent.length) {
        //        audio.src = ttssrc + fullContent.substr(index - 1, size);
        //        clickAudio.addClass("current");
        //        audio.play();
        //    } else {
        //        $(".voice").removeClass("current");
        //        audio.pause();
        //        index = 0;
        //        flag = true;
        //    }
        //}
        $('.btnAudio').click(function () {
            //if ('true' != $('#IsUserLogin').val()) {
            //    $("#loginBtn").click();
            //    return false;
            //}
            return true;
        });
    },

    dispose: function () {
        $('.areajSelect').unbind();
        $('.subjSelect').unbind();
        $('.list-filtrater').unbind();
        $('.list-filtrater .oparetion .down-all').unbind();
        $("#fblxtxtSearch").unbind();
        $('.tools-box').unbind();
        $('#choose-all').unbind();
        $('#checkReportItems').unbind();
        $('.print-all').unbind();
        $("#ugly").find("a").unbind();
        $(".filtrater").unbind();
        $('.filtrater dd').unbind();
        $(".articleSelect > dl > dd").unbind();
        $('#recordsort').unbind();
        $('#recordsort > a').unbind();
        $("#btnSubSearch").unbind();
        $(".pagination li").not("[class]").unbind();
        $(".grouping > a").unbind();
        $(".search-hit-box").unbind();
        $(".search-hit-box").find(".btn").unbind();
        $(".isHaveExt").unbind();
        $("div.condition").find("a").unbind();
        $("div.condition,#navbar").find("a[cluster_code]").unbind();
        $("div.condition,#navbar").find("a[filter_value]").unbind();
        $("div.condition,#navbar").find("a[group_value]").unbind();
        $("div.condition").find("a[filter_sort]").unbind();
        $("div.oparetion #btn-clear").unbind();
        $("div.oparetion #btn-save").unbind();
        $("div.oparetion #btn-sharewei").unbind();
        $(".more").unbind();
        $("#recordGroup [name='ShowType']").unbind();
        $("#recordGroup [name='ckbShowType']").unbind();
        $("#recordgroup >a").unbind();
        $('#batchDownload').unbind();
        $('#batchAddFav').unbind();
        $('#batchPrint').unbind();
        $('.recordDownload').unbind();
        $('.recordAddFavorite').unbind();
        $('.recordPrint').unbind();
        $('.recordTransfer').unbind();
        $('.recordShare').unbind();
        $('.batchTransmit').unbind();
        $('#batchCaseReport').unbind();
        $('#generateReport').unbind();
        $('.addcasereport').unbind();
        $('.casereport').unbind();
        $(".wordCloud").unbind();
        $(".rename").unbind();
        $(".deleteReport").unbind();
        $(".deleteReportArticle").unbind();
        $(".delete-all").unbind();
        $(".transReport").unbind();
        $("#twoLastStep").unbind();
        $("#threeLastStep").unbind();
        $("#fourLastStep").unbind();
        $("#generateReport").unbind();
        $("#caseReportSave").unbind();
        $("#caseReportDownload").unbind();
        $(".a-index-list").find(".c-bar").unbind();
        $(".a-index-list").find("th a").unbind();
        $(".btn-list .history-btn").unbind();
        $(".btn-list .FocusAndBasis").unbind();
        $("#fblxbtnSearch").unbind();
        $(".specialSelect > dl > dd").unbind();
        $("#specialsort > a").unbind();
        $('.sort').unbind();
        $('.sort a').unbind();
        $('.team').unbind();
        $('.team a').unbind();
        $(".grouping-title a[groupvalue]").unbind();
        $(".more a[groupvalue]").unbind();
        $('#subKeywords').unbind();
        $("a.citeStat").unbind();
        $(".isHaveAssociation").unbind();
        $(".author-list .title .more").unbind();
        $(".view-type > a").unbind();
        $('.view-type a').unbind();
        $(".downloadCatalogue").unbind();
        $('.btnAudio').unbind();
    },
    getCatalogDownLoadAllFields: function () {
        var lib = $("input[name='Library']").val();
        $.ajax({
            url: "/full/GetCatalogDownLoadFields",
            type: "POST",
            async: false,
            data: {
                "library": lib
            },
            success: function (results) {
                return results;
            }, error: function () {

            }
        });
    }

}

var Show_reply = function (r) {
    if (r == 1)
        layer.msg('收藏成功！', {
            icon: 1,
            time: 2000//2秒关闭（如果不配置，默认是3秒）                      
        });
    else if (r == 2)
        layer.msg('收藏成功！', {
            icon: 1,
            time: 2000//2秒关闭（如果不配置，默认是3秒）                      
        });
    else {
        alert('收藏失败！');
    }
};