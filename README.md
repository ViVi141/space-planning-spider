# 空间规划政策爬虫与合规性分析系统

**版本：v2.1.0**  
**更新时间：2025.7.8**

## 📋 项目简介

本项目是一个专门用于爬取和分析空间规划政策数据的桌面应用程序。系统集成了智能爬虫、数据管理、合规性分析、政策对比和数据导出等功能，主要面向国土空间规划、城市更新等领域的政策研究人员和从业人员。

## ✨ 核心功能

### 🕷️ 智能爬虫系统
- **多源数据爬取**：支持国家住建部等官方机构的政策数据爬取
- **智能反爬虫**：内置多种反爬虫策略，支持快速/正常/慢速三种模式
- **实时进度显示**：爬取过程中实时显示进度和数据获取情况
- **关键词过滤**：支持多关键词组合搜索，精确匹配目标政策

### 📊 数据管理与分析
- **本地数据库存储**：使用 SQLite 数据库，支持离线查询
- **智能数据更新**：自动检测数据时效性，智能判断是否需要更新
- **分页显示**：支持大量数据的分页浏览和快速定位

### 🔍 合规性分析
- **政策合规性评估**：对政策文本进行合规性评分和风险识别
- **关键词高亮**：自动识别和高亮显示关键政策条款
- **风险等级分类**：根据合规性分析结果进行风险等级划分

### 🔄 政策对比功能
- **多政策对比**：支持多个政策文件的相似度对比
- **智能匹配**：基于文本相似度算法进行政策条款匹配
- **差异分析**：自动识别政策间的差异点和变化趋势

### 📤 数据导出
- **多格式支持**：支持导出为 Word、Excel 等常用格式
- **自定义模板**：支持自定义导出模板和格式
- **批量导出**：支持批量导出选定的政策数据

## 🖥️ 图形界面

- **现代化界面**：基于 PyQt5 构建的现代化桌面界面
- **操作简便**：预设模式选择，一键启动常用功能
- **实时反馈**：操作过程中实时显示进度和状态信息
- **多窗口支持**：支持多窗口操作，提高工作效率

## 📁 项目结构

```
space-planning-spider/
├── src/space_planning/          # 源代码目录
│   ├── main.py                  # 主程序入口
│   ├── core/                    # 核心模块
│   │   ├── config.py           # 配置管理
│   │   └── database.py         # 数据库操作
│   ├── gui/                     # 图形界面
│   │   └── main_window.py      # 主窗口界面
│   ├── spider/                  # 爬虫模块
│   │   ├── national.py         # 国家级政策爬虫
│   │   ├── anti_crawler.py     # 反爬虫策略
│   │   └── monitor.py          # 爬虫监控
│   └── utils/                   # 工具模块
│       ├── compare.py          # 政策对比
│       ├── compliance.py       # 合规性分析
│       └── export.py           # 数据导出
├── docs/                        # 文档目录
├── venv/                        # 虚拟环境
├── requirements.txt             # 依赖包列表
├── 安装模式设置.py             # 安装模式设置脚本
├── 数据库迁移工具.py           # 数据迁移工具
├── 安装模式启动.bat            # 安装模式启动脚本
├── 启动程序.bat                # 便携模式启动脚本
├── 打包脚本.bat                # 项目打包脚本
├── 版本发布.bat                # 版本发布工具
└── README.md                   # 项目说明
```

## 🚀 快速开始

### 环境要求
- **操作系统**：Windows 7/8/10/11 (64位)
- **Python版本**：Python 3.7 及以上
- **内存要求**：建议 4GB 以上
- **网络要求**：需要稳定的互联网连接

### 运行模式

本项目支持两种运行模式：

#### 1. 安装模式（推荐）⭐
- **数据持久化**：数据库存储在用户文档目录，程序关闭后数据不会丢失
- **多用户支持**：每个用户有独立的数据目录
- **自动备份**：支持数据库自动备份和恢复
- **配置管理**：用户配置独立保存
- **固定程序目录**：程序安装在固定位置，便于管理

**数据目录位置：**
- Windows: `%USERPROFILE%\Documents\空间规划政策爬虫系统\`
- macOS: `~/Library/Application Support/空间规划政策爬虫系统/`
- Linux: `~/.config/空间规划政策爬虫系统/`

#### 2. 便携模式
- **便携性**：数据库存储在程序目录，可移动整个程序
- **简单部署**：无需安装，直接运行
- **数据风险**：程序目录删除会导致数据丢失

### 安装步骤

#### 方式一：安装模式（推荐）

1. **克隆项目**
   ```bash
   git clone https://gitee.com/ViVi141/space-planning-spider.git
   cd space-planning-spider
   ```

2. **创建虚拟环境**（推荐）
   ```bash
   python -m venv venv
   venv\Scripts\activate
   ```

3. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

4. **设置安装模式**
   ```bash
   # 运行安装模式设置脚本
   python 安装模式设置.py
   ```

5. **数据迁移**（如果有旧版本数据）
   ```bash
   # 运行数据库迁移工具
   python 数据库迁移工具.py
   ```

6. **启动程序**
   ```bash
   # 使用安装模式启动脚本
   安装模式启动.bat
   
   # 或直接运行
   python -m space_planning.main
   ```

#### 方式二：便携模式

1. **克隆项目**
   ```bash
   git clone https://gitee.com/ViVi141/space-planning-spider.git
   cd space-planning-spider
   ```

2. **创建虚拟环境**
   ```bash
   python -m venv venv
   venv\Scripts\activate
   ```

3. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

4. **启动程序**
   ```bash
   # 使用便携模式启动脚本
   启动程序.bat
   
   # 或直接运行
   python src/space_planning/main.py
   ```

## 📖 使用指南

### 基本操作流程

1. **选择预设模式**
   - 日常监控模式：最近30天的政策数据
   - 项目分析模式：最近6个月的政策数据
   - 历史补全模式：最近2年的政策数据

2. **设置搜索参数**
   - 选择目标机构（国家住建部等）
   - 输入关键词（可选，支持多关键词）
   - 设置时间范围（可选）

3. **执行智能搜索**
   - 点击"智能查询"按钮
   - 系统自动判断是否需要爬取新数据
   - 实时显示查询和爬取进度

4. **后续分析操作**
   - 查看政策详情
   - 进行合规性分析
   - 执行政策对比
   - 导出数据

### 高级功能

#### 数据库管理
1. 在菜单中选择"工具 -> 数据库管理"
2. 查看数据库状态和配置信息
3. 手动备份数据库
4. 从备份文件恢复数据库
5. 清理旧的备份文件

#### 合规性分析
1. 选择要分析的政策
2. 输入项目关键词
3. 系统自动进行合规性评估
4. 查看分析结果和风险等级

#### 政策对比
1. 选择多个政策文件
2. 系统自动计算相似度
3. 查看对比结果和差异分析

#### 数据导出
1. 选择要导出的数据
2. 选择导出格式（Word/Excel）
3. 选择保存位置
4. 完成导出

## 🔧 技术架构

### 核心技术栈
- **GUI框架**：PyQt5 - 现代化桌面界面
- **网络请求**：requests - HTTP请求处理
- **HTML解析**：BeautifulSoup4 + lxml - 网页内容解析
- **数据库**：SQLite - 本地数据存储
- **文本处理**：fuzzywuzzy + python-Levenshtein - 文本相似度计算
- **文档处理**：python-docx - Word文档生成

### 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用户界面层     │    │    业务逻辑层    │    │    数据访问层    │
│   (PyQt5 GUI)   │◄──►│  (爬虫/分析)     │◄──►│   (SQLite DB)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   配置管理      │    │   反爬虫策略     │    │   数据备份      │
│   (JSON配置)    │    │   (频率限制)     │    │   (自动备份)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 📋 功能特性

### 智能爬虫
- **多线程爬取**：支持并发爬取，提高效率
- **智能重试**：网络异常时自动重试
- **进度监控**：实时显示爬取进度和状态
- **数据去重**：自动识别和过滤重复数据

### 数据管理
- **本地存储**：数据存储在本地SQLite数据库
- **全文检索**：支持政策标题和内容的全文搜索
- **分页浏览**：支持大量数据的分页显示
- **数据导出**：支持多种格式的数据导出

### 合规性分析
- **关键词识别**：自动识别政策中的关键条款
- **风险评估**：基于关键词进行合规性风险评估
- **评分系统**：提供量化的合规性评分
- **建议生成**：自动生成合规性建议

### 政策对比
- **相似度计算**：使用多种算法计算政策相似度
- **差异分析**：自动识别政策间的差异点
- **可视化展示**：直观展示对比结果
- **批量对比**：支持多个政策的批量对比

## 🛠️ 开发指南

### 环境搭建
1. 克隆项目到本地
2. 创建Python虚拟环境
3. 安装项目依赖
4. 配置开发环境

### 代码结构
- `src/space_planning/main.py` - 程序入口
- `src/space_planning/core/` - 核心功能模块
- `src/space_planning/gui/` - 图形界面模块
- `src/space_planning/spider/` - 爬虫模块
- `src/space_planning/utils/` - 工具模块

### 添加新功能
1. 在相应模块中添加功能代码
2. 更新配置文件（如需要）
3. 添加界面元素（如需要）
4. 更新文档和测试

## 📝 更新日志

### v2.0.0 (2025-07-07)
- ✨ 新增安装模式支持
- ✨ 新增数据库自动备份功能
- ✨ 新增数据迁移工具
- 🔧 优化配置管理系统
- 🔧 改进错误处理和日志记录
- 🐛 修复多个已知问题

### v1.1.1 (2024-07-06)
- 🐛 修复数据库路径问题，解决打包后无法爬取的问题

### v1.1.0 (2024-07-06)
- ✨ 增加网络环境兼容性检测和诊断工具

### v1.0.0 (2024-01-XX)
- 🎉 首次发布
- ✨ 基础爬虫功能
- ✨ 数据管理功能
- ✨ 合规性分析功能
- ✨ 政策对比功能
- ✨ 数据导出功能

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目！

### 提交规范
- 使用清晰的提交信息
- 遵循代码规范
- 添加必要的测试
- 更新相关文档

### 开发环境
- Python 3.7+
- PyQt5
- SQLite3
- 其他依赖见requirements.txt

## 📄 许可证

本项目采用 MIT 许可证，详见 [LICENSE](LICENSE) 文件。

## 📞 联系方式

- 项目地址：https://gitee.com/ViVi141/space-planning-spider
- 问题反馈：请在Gitee上提交Issue
- 邮箱联系：请通过Gitee私信联系

---

**注意**：本项目仅供学习和研究使用，请遵守相关法律法规和网站使用条款。 