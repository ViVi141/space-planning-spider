# 广东政策 Excel 导出指南

## 1. 功能简介
- **脚本位置**：`scripts/export_guangdong_policies_excel.py`
- **输出内容**：生成 `guangdong_policies.xlsx`，包含四列：
  1. 分类名称
  2. 年份
  3. 政策标题
  4. 政策链接
- **覆盖范围**：所有分类、所有可用年份（包括 1990 年代及更早的记录，只要聚合页提供）。

## 2. 使用步骤
1. 确保运行环境已激活（`python` 指向项目虚拟环境）。
2. 在项目根目录执行：
   ```powershell
   python scripts/export_guangdong_policies_excel.py
   ```
3. 等待脚本完成（输出日志会显示每个分类、年份的抓取情况）。
4. 在根目录找到 `guangdong_policies.xlsx`。

## 3. 输出文件结构
- **工作簿**：单表，名称为“广东政策”。
- **排序**：按 “分类名称 → 年份 → 标题” 升序排列，便于快速筛选。
- **编码**：UTF-8。
- **依赖**：脚本使用标准库动态生成 XLSX，无需额外安装 `pandas` 或 `openpyxl`。

## 4. 日志说明
| 日志信息 | 含义 |
| -------- | ---- |
| `刷新分类年份统计...` | 调用 `_refresh_category_year_counts()`，读取站点聚合年份。 |
| `分类[...] 年份区间: ... 共X个年份` | 总览当前分类所有年份。若 X 很大说明存在 20 世纪数据。 |
| `抓取 XXX - YYYY 年` | 正在处理某分类某年份。 |
| `跨年数据已过滤` | 某条政策被判定不属于目标年份，已自动跳过。 |
| `双请求模式完成` | 记录该年份实际保留的政策数量。 |

## 5. 常见问题
| 问题 | 解决方案 |
| ---- | -------- |
| Excel 为空或数据少 | 检查日志是否存在 403/429；必要时调整网络环境或放慢频率。 |
| 某年份缺失 | 先确认聚合页是否存在对应年份；若站点未提供则无法抓取。 |
| 需增量导出 | 目前脚本默认全量；可按需修改 `crawl_category_year` 调用逻辑，仅遍历指定年份。 |
| 终端字体乱码 | PowerShell 可执行 `chcp 65001` 切换到 UTF-8。 |

## 6. 脚本扩展建议
- 增加参数解析（例如 `--year 2020`）以支持定向导出。
- 输出多表结构（按分类拆分工作表）便于后续分析。
- 引入断点续传机制，避免长时间任务中断后重复抓取。

> 提示：如需快速验证年份正确性，可先运行 `scripts/test_dfxfg_year_filter.py` 对单分类抽样测试。***

